
	
	<h1 class="entry-title full-title"><a href="http://custardbelly.com/blog/2013/03/06/the-making-of-a-test-driven-grocery-list-application-in-js-part-x/" title="Permanent link to The Making of a Test-Driven Grocery List Application in JS: Part X" rel="bookmark" rev="post-823">The Making of a Test-Driven Grocery List Application in JS: Part X</a></h1>
	
	<div class="entry-content full-content">
		<p><em>This is the tenth installment in a series of building a Test-Driven Grocery List application using <a href="http://pivotal.github.com/jasmine/" target="_blank">Jasmine</a> and <a href="http://requirejs.org" target="_blank">RequireJS</a>. To learn more about the intent and general concept of the series please visit <a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-javascript-part-i/">The Making of a Test-Driven Grocery List Application in JavaScript: Part I</a></em><br>
—</p>
<h2>Introduction</h2>
<p>When we last left, we properly modified <code>list-controller</code> to support event notification upon change to its collection as well as created a <code>storage-service</code> communication layer with <code>localStorage</code>. That gave us some great passing tests, but nothing to show off as the service was not integrated into the <strong>Grocery List</strong> application. In this article, we’ll do just that, but…</p>
<h2>Before we hook up list-controller events to storage-service operations…</h2>
<p>We need a way to supply the <code>list-controller</code> with the stored items. The <code>list-controller</code> has a <code>createNewItem()</code> method, but no methods to provide a previously created item. Since we are not burdening the <code>list-controller</code> in communicating with the <code>storage-service</code> directly, we’ll need to open up the API to allow items to be added – at least at the onset.</p>
<h3>Tests</h3>
<p>First we’ll include all our tests in our <em>specrunner</em> again as changes to <code>list-controller</code> may impact tests across multiple specs. And while we are poking around, let’s add a spec suite for <code>setItems()</code> on the <code>list-controller</code> and watch it fail:</p>
<p><em>/test/jasmine/spec/list-controller.spec.js</em></p>
<div><pre><div class="line number0 index0 alt1 break"><code class="jscript plain">describe(</code><code class="jscript string">'setItems()'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number1 index1 alt2">&nbsp;</div><div class="line number2 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">itemOne = modelFactory.create(),</code></div><div class="line number3 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemTwo = modelFactory.create();</code></div><div class="line number4 index4 alt1">&nbsp;</div><div class="line number5 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">beforeEach( </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number6 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemOne.name = </code><code class="jscript string">'apples'</code><code class="jscript plain">;</code></div><div class="line number7 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemTwo.name = </code><code class="jscript string">'oranges'</code><code class="jscript plain">;</code></div><div class="line number8 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.setItems([itemOne, itemTwo]);</code></div><div class="line number9 index9 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number10 index10 alt1">&nbsp;</div><div class="line number11 index11 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">afterEach( </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number12 index12 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.getItemList().removeAll();</code></div><div class="line number13 index13 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number14 index14 alt1">&nbsp;</div><div class="line number15 index15 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">it(</code><code class="jscript string">'should fill list with provided items'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number16 index16 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">items = listController.getItemList();</code></div><div class="line number17 index17 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(items.itemLength()).toEqual(2);</code></div><div class="line number18 index18 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(items.getItemAt(0)).toBe(itemOne);</code></div><div class="line number19 index19 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(items.getItemAt(1)).toBe(itemTwo);</code></div><div class="line number20 index20 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number21 index21 alt2">&nbsp;</div><div class="line number22 index22 alt1"><code class="jscript plain">});</code></div></pre></div>
<p>This simple first spec tells us that an array of items can be provided to the <code>list-controller</code> using <code>setItems()</code> and should be accessible by its collection. And we fail with no surprises:<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_17.png" alt="Failing on setItems of list-controller"></p>
<h3>list-controller modification</h3>
<p>Throughout this series I have employed a quasi-<a href="http://coderetreat.org/facilitating/activities/tdd-as-if-you-meant-it" target="_blank"><em>“TDD as if you mean it”</em></a> approach when creating new components and modifying the API on existing ones. With this modification to the <code>list-controller</code>, I am going to stick to getting the tests to pass by modifying the <code>list-controller</code> directly as I feel it is going to get a little more involved and will require some refactoring that would be better suited by focusing on true implementation.</p>
<p>With that said, let’s modify <code>list-controller</code> to get that new spec passing:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number19 index0 alt2"><code class="jscript plain">listController = {</code></div><div class="line number20 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$view: undefined,</code></div><div class="line number21 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">getItemList: </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number22 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">collection;</code></div><div class="line number23 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number24 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">getRendererFromItem: </code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number25 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i = rendererList.itemLength(),</code></div><div class="line number26 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">renderer;</code></div><div class="line number27 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">while</code><code class="jscript plain">( --i &gt; -1 ) {</code></div><div class="line number28 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">renderer = rendererList.getItemAt(i);</code></div><div class="line number29 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(renderer.model === item) {</code></div><div class="line number30 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">renderer;</code></div><div class="line number31 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number32 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number33 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">undefined;</code></div><div class="line number34 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number35 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">createNewItem: </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number36 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model = modelFactory.create();</code></div><div class="line number37 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">collection.addItem(model);</code></div><div class="line number38 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">model;</code></div><div class="line number39 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number40 index21 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">removeItem: </code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number41 index22 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">collection.removeItem(item);</code></div><div class="line number42 index23 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number43 index24 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">setView: </code><code class="jscript keyword">function</code><code class="jscript plain">(view) {</code></div><div class="line number44 index25 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.$view = (view </code><code class="jscript keyword">instanceof</code> <code class="jscript plain">$) ? view : $(view);</code></div><div class="line number45 index26 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number46 index27 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">setItems: </code><code class="jscript keyword">function</code><code class="jscript plain">(items) {</code></div><div class="line number47 index28 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">collection = collectionFactory.create(items);</code></div><div class="line number48 index29 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number49 index30 alt2"><code class="jscript plain">};</code></div></pre></div>
<p>Well, that was easy enough!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_18.png" alt="Passing on setItems() of list-controller"></p>
<h3>Tests</h3>
<p>Not so fast… I think our single spec may be deceiving our expectations. Let’s add a few more and make sure we are on the right path. To start, we expect changes to these new models to propagate events when it is modified – such as in the work we have done previously.</p>
<p><em>/test/jasmine/spec/list-controller.spec.js</em></p>
<div><pre><div class="line number62 index0 alt1"><code class="jscript plain">async.it(</code><code class="jscript string">'should dispatch events of property-change from provided items'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(done) {</code></div><div class="line number63 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">items = listController.getItemList(),</code></div><div class="line number64 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemOne = items.getItemAt(0);</code></div><div class="line number65 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$(listController).on(</code><code class="jscript string">'save-item'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number66 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).off(</code><code class="jscript string">'save-item'</code><code class="jscript plain">);</code></div><div class="line number67 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(event.item).toBe(itemOne);</code></div><div class="line number68 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">done();</code></div><div class="line number69 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number70 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">itemOne.marked = </code><code class="jscript keyword">true</code><code class="jscript plain">;</code></div><div class="line number71 index9 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>This spec tells us that changes to an item should be notified through the <code>list-controller</code> – basically the work we had done previously in getting the <code>list-controller</code> to dispatch events related to its underlying collection so as to be captured by observing parties.<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_19.png" alt="Failing on async timeout of event from item"></p>
<p>This test actually reveals some refactoring that is required within the <code>list-controller</code>. In essence, creating a new collection from the provided items in <code>setItems()</code> is not enough to have the application work as expected – each individual item needs to be managed by a <code>list-item-controller</code> which responds and notifies of changes accordingly. We had previously paired an item with a item controller within the <code>collection-change</code> event handler of the collection in <code>list-controller</code>:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number51 index0 alt2"><code class="jscript plain">(</code><code class="jscript keyword">function</code> <code class="jscript plain">assignCollectionHandlers($collection) {</code></div><div class="line number52 index1 alt1">&nbsp;</div><div class="line number53 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">EventKindEnum = collectionFactory.collectionEventKind,</code></div><div class="line number54 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">isValidValue = </code><code class="jscript keyword">function</code><code class="jscript plain">(value) {</code></div><div class="line number55 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">value &amp;&amp; (value.hasOwnProperty(</code><code class="jscript string">'length'</code><code class="jscript plain">) &amp;&amp; value.length &gt; 0);</code></div><div class="line number56 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number57 index6 alt2">&nbsp;</div><div class="line number58 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$collection.on(</code><code class="jscript string">'collection-change'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number59 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model,</code></div><div class="line number60 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController,</code></div><div class="line number61 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController,</code></div><div class="line number62 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView;</code></div><div class="line number63 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">switch</code><code class="jscript plain">( event.kind ) {</code></div><div class="line number64 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.ADD:</code></div><div class="line number65 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = $(</code><code class="jscript string">'&lt;li&gt;'</code><code class="jscript plain">);</code></div><div class="line number66 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number67 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = itemControllerFactory.create($itemView, model);</code></div><div class="line number68 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController = $(itemController);</code></div><div class="line number69 index18 alt2">&nbsp;</div><div class="line number70 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.appendTo(listController.$view);</code></div><div class="line number71 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.addItem(itemController);</code></div><div class="line number72 index21 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createSaveEvent(model));</code></div><div class="line number73 index22 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.state = itemControllerFactory.state.EDITABLE;</code></div><div class="line number74 index23 alt1">&nbsp;</div><div class="line number75 index24 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.on(</code><code class="jscript string">'remove'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number76 index25 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(model);</code></div><div class="line number77 index26 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number78 index27 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.on(</code><code class="jscript string">'commit'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number79 index28 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(!isValidValue(model.name)) {</code></div><div class="line number80 index29 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(model);</code></div><div class="line number81 index30 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number82 index31 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">else</code> <code class="jscript plain">{</code></div><div class="line number83 index32 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createSaveEvent(model));</code></div><div class="line number84 index33 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number85 index34 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number86 index35 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number87 index36 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.REMOVE:</code></div><div class="line number88 index37 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number89 index38 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = listController.getRendererFromItem(model),</code></div><div class="line number90 index39 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController = $(itemController);</code></div><div class="line number91 index40 alt2">&nbsp;</div><div class="line number92 index41 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(itemController) {</code></div><div class="line number93 index42 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = itemController.parentView;</code></div><div class="line number94 index43 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.remove();</code></div><div class="line number95 index44 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.dispose();</code></div><div class="line number96 index45 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.off(</code><code class="jscript string">'remove'</code><code class="jscript plain">);</code></div><div class="line number97 index46 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.off(</code><code class="jscript string">'commit'</code><code class="jscript plain">);</code></div><div class="line number98 index47 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.removeItem(itemController);</code></div><div class="line number99 index48 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createRemoveEvent(model));</code></div><div class="line number100 index49 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number101 index50 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number102 index51 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.RESET:</code></div><div class="line number103 index52 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number104 index53 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number105 index54 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number106 index55 alt1">&nbsp;</div><div class="line number107 index56 alt2"><code class="jscript plain">}($(collection)));</code></div></pre></div>
<p>That <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank">IIFE</a> was run in the module prior to returning the <code>list-controller</code> instance. Now, we could just copy that code from the <code>EventKindEnum.ADD</code> case and shove it into <code>setItems()</code>, applying it to each item in a loop, but that wouldn’t be very efficient, not to mention a cry-inducing solution for anyone (including yourself) which need to revisit your code.</p>
<h3>list-controller refactor</h3>
<p>I think we are going to have to get rid of this <strong>IIFE</strong>, but let’s do that modification in piecemeal; first, let’s strip out the item management when added to a collection:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number17 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">collection = collectionFactory.create(),</code></div><div class="line number18 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList = collectionFactory.create(),</code></div><div class="line number19 index2 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">manageItemInList = </code><code class="jscript keyword">function</code><code class="jscript plain">(item, listController) {</code></div><div class="line number20 index3 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">$itemView = $(</code><code class="jscript string">'&lt;li&gt;'</code><code class="jscript plain">),</code></div><div class="line number21 index4 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = itemControllerFactory.create($itemView, item),</code></div><div class="line number22 index5 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController = $(itemController),</code></div><div class="line number23 index6 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">isValidValue = </code><code class="jscript keyword">function</code><code class="jscript plain">(value) {</code></div><div class="line number24 index7 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">value &amp;&amp; (value.hasOwnProperty(</code><code class="jscript string">'length'</code><code class="jscript plain">) &amp;&amp; value.length &gt; 0);</code></div><div class="line number25 index8 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number26 index9 alt1 highlighted">&nbsp;</div><div class="line number27 index10 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.appendTo(listController.$view);</code></div><div class="line number28 index11 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.addItem(itemController);</code></div><div class="line number29 index12 alt2 highlighted">&nbsp;</div><div class="line number30 index13 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.on(</code><code class="jscript string">'remove'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number31 index14 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(item);</code></div><div class="line number32 index15 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number33 index16 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.on(</code><code class="jscript string">'commit'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number34 index17 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(!isValidValue(item.name)) {</code></div><div class="line number35 index18 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(item);</code></div><div class="line number36 index19 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number37 index20 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">else</code> <code class="jscript plain">{</code></div><div class="line number38 index21 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createSaveEvent(item));</code></div><div class="line number39 index22 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number40 index23 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number41 index24 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">itemController;</code></div><div class="line number42 index25 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number43 index26 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController = {</code></div><div class="line number44 index27 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$view: undefined,</code></div><div class="line number45 index28 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">...</code></div><div class="line number46 index29 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div></pre></div>
<p>Most of what was held in the <code>EventKindEnum.ADD</code> case of the <code>collection-change</code> handler has been moved to its own function expression – <code>manageItemInList()</code>. If we look at how this case is modified we see that we have left state initialization and event dispatching:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number85 index0 alt2"><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.ADD:</code></div><div class="line number86 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number87 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">itemController = manageItemInList(model, listController);</code></div><div class="line number88 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">itemController.state = itemControllerFactory.state.EDITABLE;</code></div><div class="line number89 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createSaveEvent(model));</code></div><div class="line number90 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div></pre></div>
<p>When an item is added to the collection and the list-controller is notified, it creates a new <code>list-item-controller</code> using <code>manageItemInList()</code>, sets the controller’s state to <code>EDITABLE</code> and notifies of its addition. The last two operations are of note, as they only pertain to <em>new</em> additions to the collection – we don’t want such things for existing items being added to the list from <code>setItems()</code>.</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number70 index0 alt1"><code class="jscript plain">setItems: </code><code class="jscript keyword">function</code><code class="jscript plain">(items) {</code></div><div class="line number71 index1 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i, length = items.length;</code></div><div class="line number72 index2 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">collection = collectionFactory.create();</code></div><div class="line number73 index3 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">for</code><code class="jscript plain">( i = 0; i &lt; length; i++ ) {</code></div><div class="line number74 index4 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">manageItemInList(items[i], </code><code class="jscript keyword">this</code><code class="jscript plain">);</code></div><div class="line number75 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">collection.addItem(items[i]);</code></div><div class="line number76 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number77 index7 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>Now if we run the tests again:<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_20.png" alt="Passing on modifications to item management in list-controller"></p>
<p>Passing! </p>
<h3>Tests</h3>
<p>I don’t think we are out of the woods yet, however… Let’s continue to add more expectations about setting the collection through <code>setItems() </code>on <code>list-controller</code>:</p>
<p><em>/test/jasmine/spec/list-controller.spec.js</em></p>
<div><pre><div class="line number75 index0 alt2"><code class="jscript plain">async.it(</code><code class="jscript string">'should dispatch event of remove-item from collection'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(done) {</code></div><div class="line number76 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$(listController).on(</code><code class="jscript string">'remove-item'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number77 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).off(</code><code class="jscript string">'remove-item'</code><code class="jscript plain">);</code></div><div class="line number78 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(event.item).toBe(itemOne);</code></div><div class="line number79 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">done();</code></div><div class="line number80 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number81 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(itemOne);</code></div><div class="line number82 index7 alt1"><code class="jscript plain">});</code></div></pre></div>
<p>This test ensures that the <code>list-controller</code> should still be responding to and notifying of changes to the new collection created through <code>setItems()</code> just as it should if the <code>list-controller</code> was only being instructed to modify the collection through calls to <code>createNewItem()</code>.</p>
<h3>list-controller refactoring</h3>
<p>To save you some time in downloading more images, believe me when I tell you I just put us back in <span style="color: red;">red</span> <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  The reason being that dang <code>assignCollectionHandlers</code> <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank">IIFE</a>. The collection that is created in <code>setItems()</code> is not being observed. The <strong>IIFE</strong> to assign events handlers is only run upon load of the module and only targets the collection instantiated in its declaration. In other words, any new collections will not be observed.</p>
<p>I say we move that <strong>IIFE</strong> out into its own expression:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number17 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">collection = collectionFactory.create(),</code></div><div class="line number18 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList = collectionFactory.create(),</code></div><div class="line number19 index2 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">assignCollectionHandlers = </code><code class="jscript keyword">function</code><code class="jscript plain">($collection) {</code></div><div class="line number20 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">EventKindEnum = collectionFactory.collectionEventKind;</code></div><div class="line number21 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$collection.on(</code><code class="jscript string">'collection-change'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number22 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model,</code></div><div class="line number23 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController,</code></div><div class="line number24 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController,</code></div><div class="line number25 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView;</code></div><div class="line number26 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">switch</code><code class="jscript plain">( event.kind ) {</code></div><div class="line number27 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.ADD:</code></div><div class="line number28 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number29 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = manageItemInList(model, listController);</code></div><div class="line number30 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.state = itemControllerFactory.state.EDITABLE;</code></div><div class="line number31 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createSaveEvent(model));</code></div><div class="line number32 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number33 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.REMOVE:</code></div><div class="line number34 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number35 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = listController.getRendererFromItem(model),</code></div><div class="line number36 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController = $(itemController);</code></div><div class="line number37 index20 alt2">&nbsp;</div><div class="line number38 index21 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(itemController) {</code></div><div class="line number39 index22 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = itemController.parentView;</code></div><div class="line number40 index23 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.remove();</code></div><div class="line number41 index24 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.dispose();</code></div><div class="line number42 index25 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.off(</code><code class="jscript string">'remove'</code><code class="jscript plain">);</code></div><div class="line number43 index26 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemController.off(</code><code class="jscript string">'commit'</code><code class="jscript plain">);</code></div><div class="line number44 index27 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.removeItem(itemController);</code></div><div class="line number45 index28 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(listController).trigger(createRemoveEvent(model));</code></div><div class="line number46 index29 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number47 index30 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number48 index31 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.RESET:</code></div><div class="line number49 index32 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number50 index33 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number51 index34 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number52 index35 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number53 index36 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">manageItemInList = </code><code class="jscript keyword">function</code><code class="jscript plain">(item, listController) {</code></div><div class="line number54 index37 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// implementation removed to reduce noise</code></div><div class="line number55 index38 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number56 index39 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController = {</code></div><div class="line number57 index40 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// implementation removed to reduce noise</code></div><div class="line number58 index41 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div></pre></div>
<p>We basically took what was the named <code>assignCollectionHandlers</code> <strong>IIFE</strong> and added it to the variable declarations within the <code>list-controller</code> module. That changes the code between those declarations and the return of the <code>listController</code> instance to:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number17 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">collection = collectionFactory.create(),</code></div><div class="line number18 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList = collectionFactory.create(),</code></div><div class="line number19 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">assignCollectionHandlers = </code><code class="jscript keyword">function</code><code class="jscript plain">($collection) {</code></div><div class="line number20 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// implementation removed to reduce noise</code></div><div class="line number21 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number22 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">manageItemInList = </code><code class="jscript keyword">function</code><code class="jscript plain">(item, listController) {</code></div><div class="line number23 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// implementation removed to reduce noise</code></div><div class="line number24 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number25 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController = {</code></div><div class="line number26 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// implementation removed to reduce noise</code></div><div class="line number27 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number28 index11 alt1">&nbsp;</div><div class="line number29 index12 alt2 highlighted"><code class="jscript plain">assignCollectionHandlers($(collection));</code></div><div class="line number30 index13 alt1">&nbsp;</div><div class="line number31 index14 alt2"><code class="jscript keyword">return</code> <code class="jscript plain">listController;</code></div></pre></div>
<p>With those changes we are still failing on the last spec we created, but more importantly we have not caused any other tests to fail!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_21.png" alt="Still failing, but failing well!"></p>
<p>Let’s get that last spec to pass:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number104 index0 alt1"><code class="jscript plain">setItems: </code><code class="jscript keyword">function</code><code class="jscript plain">(items) {</code></div><div class="line number105 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i, length = items.length;</code></div><div class="line number106 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">collection = collectionFactory.create();</code></div><div class="line number107 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">for</code><code class="jscript plain">( i = 0; i &lt; length; i++ ) {</code></div><div class="line number108 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">manageItemInList(items[i], </code><code class="jscript keyword">this</code><code class="jscript plain">);</code></div><div class="line number109 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">collection.addItem(items[i]);</code></div><div class="line number110 index6 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number111 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">assignCollectionHandlers($(collection));</code></div><div class="line number112 index8 alt1"><code class="jscript plain">}</code></div></pre></div>
<p>Hurrah!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_ix_22.png" alt="Passing again!"></p>
<p>Tagged <strong>0.1.13</strong>: <a href="https://github.com/bustardcelly/grocery-ls/tree/0.1.13" target="_blank">https://github.com/bustardcelly/grocery-ls/tree/0.1.13</a></p>
<h2>Hooking it all together</h2>
<p>We have created our <code>storage-service</code> to communicate with <code>localStorage</code>, modified <code>list-controller</code> to dispatch events and accept initial items for its collection and all our tests are still passing! It’s a wonderous feeling. Now let’s get to actually hooking them up so that the <code>storage-service</code> is told how to handle changes to the list by responding to <code>list-controller</code> events.</p>
<p>Normally, in such situations I would create another component to the application that would serve as an mediator for such integration, receiving events from <code>list-controller</code> and invoking the <code>storage-service</code>. Naturally, that would also call for more tests in assuring that the mediator did its job correctly. I am not going to do that here. This is a small application meant for our own personal use and this series has gotten quite long; I don’t want to scare you away by adding more dependencies, but I would encourage you to do so on your own if you feel so…. just don’t forget the tests!</p>
<p>I think modifying the main JavaScript file (<em>/script/grocery-ls.js</em>) that defines the module dependencies and initializes the <strong>Grocery List</strong> application is fine enough for the task at hand:</p>
<p><em>/script/grocery-ls.js</em></p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript plain">(</code><code class="jscript keyword">function</code><code class="jscript plain">(window, require) {</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">require.config({</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">baseUrl: </code><code class="jscript string">"."</code><code class="jscript plain">,</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">paths: {</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"lib"</code><code class="jscript plain">: </code><code class="jscript string">"./lib"</code><code class="jscript plain">,</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"script"</code><code class="jscript plain">: </code><code class="jscript string">"./script"</code><code class="jscript plain">,</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"jquery"</code><code class="jscript plain">: </code><code class="jscript string">"./lib/jquery-1.8.3.min"</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">require( [</code><code class="jscript string">'jquery'</code><code class="jscript plain">, </code><code class="jscript string">'script/controller/list-controller'</code><code class="jscript plain">, </code><code class="jscript string">'script/service/storage-service'</code><code class="jscript plain">],</code></div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">function</code><code class="jscript plain">($, listController, storageService) {</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">$listController = $(listController);</code></div><div class="line number16 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.setView($(</code><code class="jscript string">'section.groceries ul'</code><code class="jscript plain">));</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">storageService.getItems().then(</code><code class="jscript keyword">function</code><code class="jscript plain">(items) {</code></div><div class="line number19 index18 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.setItems(items);</code></div><div class="line number20 index19 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number21 index20 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$listController.on(</code><code class="jscript string">'save-item'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number22 index21 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">storageService.saveItem(event.item).then(</code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number23 index22 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">console.log(</code><code class="jscript string">'Item saved! '</code> <code class="jscript plain">+ item.name);</code></div><div class="line number24 index23 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}, </code><code class="jscript keyword">function</code><code class="jscript plain">(error) {</code></div><div class="line number25 index24 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">console.log(</code><code class="jscript string">'Item not saved: '</code> <code class="jscript plain">+ error)</code></div><div class="line number26 index25 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number27 index26 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number28 index27 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$listController.on(</code><code class="jscript string">'remove-item'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number29 index28 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">storageService.removeItem(event.item).then(</code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number30 index29 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">console.log(</code><code class="jscript string">'Item removed! '</code> <code class="jscript plain">+ item.name);</code></div><div class="line number31 index30 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}, </code><code class="jscript keyword">function</code><code class="jscript plain">(error) {</code></div><div class="line number32 index31 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">console.log(</code><code class="jscript string">'Item not removed: '</code> <code class="jscript plain">+ error);</code></div><div class="line number33 index32 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number34 index33 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number35 index34 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'#add-item-button'</code><code class="jscript plain">).on(</code><code class="jscript string">'click'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number36 index35 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.createNewItem();</code></div><div class="line number37 index36 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number38 index37 alt1">&nbsp;</div><div class="line number39 index38 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number40 index39 alt1">&nbsp;</div><div class="line number41 index40 alt2"><code class="jscript plain">}(window, requirejs));</code></div></pre></div>
<p>Just a slight modification to the main file. We added <code>storage-service</code> as an initial dependency, request and supply stored items to the list-controller and respond to <code>save-item</code> and <code>remove-item</code> events, forwarding actions along to the <code>storage-service</code> appropriately.</p>
<p>If we run the application now, we can add, mark-off, remove items from the list. Same as before, but now, if we refresh the page, items and their state a persisted!</p>
<p><img src="http://custardbelly.com/blog/images/tdd_js/part_ix_27.png" alt="Grocery list application"></p>
<p><small>It may look a little different than your if you have been following along in the code. I added some nice styling and committed it to the repo.</small></p>
<p>Tagged <strong>0.2.0</strong> : <a href="https://github.com/bustardcelly/grocery-ls/tree/0.2.0" target="_blank">https://github.com/bustardcelly/grocery-ls/tree/0.2.0</a></p>
<h2>Conclusion</h2>
<p>We have completed our <strong>Grocery List</strong> application and have it fully tested (well, hopefully <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"> ). We now have a grocery list that we can curate and is persisted in the browser. It should be noted that it is not persistent across browser<strong>s</strong>, plural – so make sure to open it in the same browser on your mobile device when creating the list and shopping. I am most likely going to whip up a little server to persist the list remotely, but am not going to document that in this series. It may end up in the <a href="https://github.com/bustardcelly/grocery-ls">github repo</a> eventually, however, so keep an eye out.</p>
<p>Thanks for sticking around in this long series (<em>ten parts!</em>) of building an application by trying to adhere to <strong>TDD</strong>. I may have gone off course here and there, but I hope it was informative in any way.</p>
<p>Cheers!</p>
<p>—-</p>
<h1>Link Dump</h1>
<h2>Reference</h2>
<p><a href="http://tddjs.com/" target="_blank">Test-Driven JavaScript Development by Christian Johansen</a><br>
<a href="http://dannorth.net/introducing-bdd/" target="_blank">Introducing BDD by Dan North</a><br>
<a href="http://cumulative-hypotheses.org/2011/08/30/tdd-as-if-you-meant-it/">TDD as if you Meant it by Keith Braithwaite</a><br>
<a href="http://requirejs.org/" target="_blank">RequireJS</a><br>
<a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank">AMD</a><br>
<a href="http://pivotal.github.com/jasmine/" target="_blank">Jasmine</a><br>
<a href="http://sinonjs.org/" target="_blank">Sinon</a><br>
<a href="https://github.com/derickbailey/jasmine.async" target="_blank">Jasmine.Async</a></p>
<h2>Post Series</h2>
<p><a href="https://github.com/bustardcelly/grocery-ls">grocery-ls github repo</a><br>
<a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-javascript-part-i" target="_blank">Part I – Introduction</a><br>
<a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-js-part-ii">Part II – Feature: Add Item</a><br>
<a href="http://custardbelly.com/blog/2012/12/06/the-making-of-a-test-driven-grocery-list-application-in-js-part-iii">Part III – Feature: Mark-Off Item</a><br>
<a href="http://custardbelly.com/blog/2012/12/17/the-making-of-a-test-driven-grocery-list-application-in-js-part-iv">Part IV – Feature: List-Item-Controller</a><br>
<a href="http://custardbelly.com/blog/2012/12/31/the-making-of-a-test-driven-grocery-list-application-in-js-part-v/">Part V – Feature: List-Controller Refactoring</a><br>
<a href="http://custardbelly.com/blog/2013/01/08/the-making-of-a-test-driven-grocery-list-application-in-js-part-vi/" target="_blank">Part VI – Back to Passing</a><br>
<a href="http://custardbelly.com/blog/2013/01/17/the-making-of-a-test-driven-grocery-list-application-in-js-part-vii/">Part VII – Remove Item</a><br>
<a href="http://custardbelly.com/blog/2013/01/22/the-making-of-a-test-driven-grocery-list-application-part-viii/">Part VIII – Bug Fixing</a><br>
<a href="http://custardbelly.com/blog/2013/02/15/the-making-of-a-test-driven-grocery-list-application-in-js-part-ix/">Part IX – Persistence</a><br>
<a href="http://custardbelly.com/blog/2013/03/06/the-making-of-a-test-driven-grocery-list-application-in-js-part-x/">Part X – It Lives!</a></p>
		<div class="clear"></div>
	</div><!-- .entry-content-->
	
	<p class="filed categories alt-font tight">Posted in <a href="http://custardbelly.com/blog/category/amd/" title="View all posts in AMD" rel="category tag">AMD</a>,  <a href="http://custardbelly.com/blog/category/javascript/" title="View all posts in JavaScript" rel="category tag">JavaScript</a>,  <a href="http://custardbelly.com/blog/category/requirejs/" title="View all posts in RequireJS" rel="category tag">RequireJS</a>,  <a href="http://custardbelly.com/blog/category/grocery-ls/" title="View all posts in grocery-ls" rel="category tag">grocery-ls</a>,  <a href="http://custardbelly.com/blog/category/jasmine/" title="View all posts in jasmine" rel="category tag">jasmine</a>.</p>
	
	

	<p class="by-line">
		<span class="author vcard full-author">
			<span class="by alt-font">By</span> <a class="url fn" href="http://custardbelly.com/blog/author/todd-anderson/" title="View all posts by todd anderson">todd anderson</a>		</span>
		<span class="date full-date"><span class="ndash alt-font">–</span> <abbr class="published" title="2013-03-06T07:15">March 6, 2013</abbr></span>
	</p><!--/by-line-->

	<div id="post-comments-823-target"></div>
	<div class="clear"></div>
	
	