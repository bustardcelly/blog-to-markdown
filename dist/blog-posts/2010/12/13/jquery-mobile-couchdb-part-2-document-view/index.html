<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport">
    <meta name="description" content="Todd Anderson makes things for web, mobile, desktop and land with a passion of application architecture and development workflows.">
    <meta name="keywords" content="todd anderson, anderson, programmer, developer, architect, engineer, software, software development, programming, application, ria, architecture, javascript, html5, css, web, mobile, desktop, arduino, actionscript, flex, flash, python, java, objective-c, ios, android">
    <meta http-equiv="cleartype" content="on">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="alternate" type="application/rss+xml" title="Todd Anderson - feed" href="/index.xml" />
    <title>Todd Anderson - jQuery Mobile + CouchDB: Part 2 – Document View</title>
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/assets/css/main.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
    <link rel="stylesheet" href="/style/post.css" />
    <link rel="stylesheet" type="text/css" href="/lib/highlight/styles/github.css" media="all" />
  </head>
  <body>

    <!-- Header -->
      <section id="header">
        <header>
          <span class="image avatar"><img src="images/avatar.jpg" alt="" /></span>
          <h1 id="logo"><a href="#">Todd Anderson</a></h1>
          <p>Making things for web, mobile,<br />
          desktop and land</p>
        </header>
        <nav id="nav">
          <ul>
            <li><a href="/index.html" class="active" id="latest-link">Latest</a></li>
            <li><a href="/archive.html" id="archive-link">Archives</a></li>
            <li><a href="https://www.custardbelly.com">About</a></li>
            <li><a href="https://github.com/bustardcelly/custardbelly-dot-comv2/tree/master/contact" target="_blank">Contact</a></li>
          </ul>
        </nav>
        <footer>
          <ul class="icons">
            <li><a href="https://twitter.com/_toddanderson_" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
            <li><a href="https://github.com/bustardcelly" class="icon fa-github" target="_blank"><span class="label">Github</span></a></li>
            <li><a href="https://www.custardbelly.com/blog" class="icon fa-rss-square" target="_blank"><span class="label">Blog</span></a></li>
            <li><a href="https://github.com/bustardcelly/custardbelly-dot-comv2/tree/master/contact" target="_blank" class="icon fa-envelope"><span class="label">Email</span></a></li>
          </ul>
        </footer>
      </section>

    <!-- Wrapper -->
      <div id="wrapper">

        <!-- Main -->
          <div id="main">

            <!-- One -->
              <section id="one">
                <div class="container">

                  <article class="post">
  <div class="title">
    <h1><a href="/blog-posts/2010/12/13/jquery-mobile-couchdb-part-2-document-view/index.html">jQuery Mobile + CouchDB: Part 2 – Document View</a></h1>
    <p>
      2010 December 13th
      
        by todd anderson
      
    </p>
  </div>
  <section>
    <p>In the <a href="https://custardbelly.com/blog/?p=244">previous post</a> for this series, I covered getting up and running with <a href="http://jquerymobile.com/">jQuery Mobile</a> as a client-side application for a <a href="http://couchdb.apache.org/">CouchDB</a> database. Along with examples for the <strong>DHTML</strong> documents, I also covered/talked about some great tools that help along with the workflow of creating a client-side application and working with a <strong>CouchDB</strong> instance. I am going to continue using those tools – mainly <a href="http://couchapp.org/page/index">CouchApp</a> – and cover the differences between local and external jQuery Mobile pages and how to show a single document from the albums list. If you have not already, I recommend checking out the first part in this series: <a href="https://custardbelly.com/blog/?p=244">jQuery Mobile + CouchDB: Part 1 – Getting Started</a>. Some tools and directory structures are discussed in that post that will not be explained in this post.</p>
<h2 id="introduction">Introduction</h2>
<p>Looking at the current state of the client-side application created for communicating with a <a href="http://couchdb.apache.org/">CouchDB</a> instance, the landing page loads all the documents from a target database and displays them in a <a href="http://jquerymobile.com/">jQuery Mobile</a> list.</p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_three.png" alt=""></p>
<p>The database for the application holds <em>album</em> documents and a simple view was created that would return every document in the database. Currently the <strong>URL</strong> for viewing that list of documents from the albums view is <a href="http://127.0.0.1:5984/albums/_design/albums/index.html">http://127.0.0.1:5984/albums/_design/albums/index.html</a>.</p>
<p>Now i can peruse the list just fine, but what if the list items do not show all the fields pertaining to a document? (<em>* they do now, but that is the beauty of CouchDB… the album document schema can change without having me curl up and start crying under my desk!</em>) Good question, me. The application should direct the user to a detail page which shows a single document upon selection from an item in the list. Nice answer, you.</p>
<p>In this post, I will be covering how to create and navigate to a detail page for a single document from the list for our <strong>jQuery Mobile</strong> + <strong>CouchDB</strong> application. I’ll hope to address the benefits of local and external pages in the <strong>jQuery Mobile</strong> framework and how to go about displaying pages using the show functions available in the design for a <strong>CouchDB</strong> database.</p>
<h2 id="decisions-decisions">Decisions, Decisions</h2>
<p>A <a href="http://jquerymobile.com/">jQuery Mobile</a> application is comprised of pages, loosely discussed in the previous post. The framework allows for a developer to declare the content of each page inline in the same document (<em>local</em>, <em>internally linked</em>) or point to another <strong>HTML</strong> document (<em>external</em>) by providing a link as the content of a page. For some quick examples:</p>
<p><strong>Local:</strong></p>
<p><em>index.html</em></p>
<pre><code>...

<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"home"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#signin"</span>&gt;</span>Sign in?<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>welcome<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"signin"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#home"</span>&gt;</span>Nevermind<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>come in<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

...
</code></pre><p>In this example, two pages are declared (<em>home</em> and <em>signin</em>), and each have a link in their content that points to the other. By setting the <strong>href</strong> to the value of the <em>id</em> attribute of a <em>div</em> element with a <strong>data-role</strong> of <em>page</em>, preceded by a hash (#), the framework knows to display the content of that page upon request – updating the location and history as well.</p>
<p><strong>External:</strong></p>
<p><em>index.html</em></p>
<pre><code><span class="hljs-keyword">...</span>

&lt;body&gt;

    &lt;div id=<span class="hljs-string">"home"</span> data-role=<span class="hljs-string">"page"</span>&gt;

        &lt;div data-role=<span class="hljs-string">"header"</span>&gt;Home&lt;/div&gt;

        &lt;div data-role=<span class="hljs-string">"content"</span>&gt;

            &lt;p&gt;Hello World!&lt;/p&gt;

            &lt;p&gt;&lt;a href=<span class="hljs-string">"pages/signin.html"</span>&gt;Sign <span class="hljs-keyword">in</span>?&lt;/a&gt;

        &lt;/div&gt;

        &lt;div data-role=<span class="hljs-string">"footer"</span>&gt;welcome&lt;/div&gt;

    &lt;/div&gt;

&lt;/body&gt;

<span class="hljs-keyword">...</span>
</code></pre><p><em>/pages/signin.html</em></p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"signin"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"../index.html"</span>&gt;</span>Nevermind<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>come in<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
</code></pre><p><em>[* NOTE :: If you try to develop an application using externally linked pages on your local disk, you will get an error that looks somewhat like the following:</em></p>
<pre><code>XMLHttpRequest cannot <span class="hljs-operator"><span class="hljs-keyword">load</span> file:///Users/{<span class="hljs-keyword">user</span>}/{location}/index.html. Origin <span class="hljs-keyword">null</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> allowed <span class="hljs-keyword">by</span> Access-Control-Allow-Origin.</span>
</code></pre><p><em>The reason is that file:// requests produce a null Origin. Someone more familiar with <a href="http://jquerymobile.com/">jquery Mobile</a> could hopefully give a fuller explanation, but a null Origin throws an error on transitioning pages. When developing i deploy the client to my localhost for testing.*]</em></p>
<p>In this example, the landing page has a link that points to an external <strong>HTML</strong> document (<em>signin.html</em>). With a <em>div</em> element attributed as a page in the external <strong>HTML</strong> document, the location is updated to <em>/index.html#pages/signup.html</em>.</p>
<p>Both approaches have their advantages and disadvantages. The biggest advantage for internal pages is transition speed, while the biggest disadvantage for internal pages is readability; and those are switched for external pages. At least those are what i perceive as being the selling points for <strong>internal vs external</strong>, aside from the <strong>URL</strong>s…</p>
<p>I would choose external most of the time, mainly because it adds the ability to view a page without being in the flow of a whole page set in a single document. Sure, the <strong>URL</strong> is way uglier (ie <em>index.html#pages/signup.html</em> as opposed to <em>index.html#signup</em>) but hopefully i could then bug someone smarter than me to pretty up the <strong>URL</strong>s with some rewrites.</p>
<p>So, in conclusion, I lean toward external pages… but i will offer up both solutions so you can see how each would work.</p>
<h2 id="local-album-page-view">Local Album Page View</h2>
<p>First things first, fire up your favorite text editor and open the _/<em>attachments/index.html</em> page from your <a href="http://couchapp.org/page/index">CouchApp</a> directory for the albums application. We are going to add another page <em>div</em> to the document and display the album detail locally:</p>
<pre><code><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>My Albums<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/main.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/jquery.mobile-1.0a2.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>/&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">h2</span>&gt;</span>Albums<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albums"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"listview"</span> <span class="hljs-attribute">data-theme</span>=<span class="hljs-value">"c"</span> <span class="hljs-attribute">data-dividertheme</span>=<span class="hljs-value">"b"</span> /&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumview"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumheader"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"albumtitle"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumcontent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/couchapp/loader.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="javascript">

      <span class="hljs-comment">// forget about this for now.</span>

  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>In this example, we have added another <em>page</em> and given it the <strong>id</strong> attribute value of “<em>albumview</em>“. When an item from the albums list is clicked, we’ll notify the framework to navigate to that page and display the corresponding content. The <strong>JavaScript</strong> was removed for this example just to clear away the clutter from what the intention was in making a new page. Just so we know we are working with the same content, here is the full updated document with inline script:</p>
<pre><code><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>My Albums<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/main.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/jquery.mobile-1.0a2.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>/&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">h2</span>&gt;</span>Albums<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albums"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"listview"</span> <span class="hljs-attribute">data-theme</span>=<span class="hljs-value">"c"</span> <span class="hljs-attribute">data-dividertheme</span>=<span class="hljs-value">"b"</span> /&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumview"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumheader"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"albumtitle"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumcontent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/couchapp/loader.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="javascript">



      $db = $.couch.db(<span class="hljs-string">"albums"</span>);



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleDocumentReady</span><span class="hljs-params">()</span>

      {</span>

          refreshAlbums();

      }



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshAlbums</span><span class="hljs-params">()</span>

      {</span>

          $(<span class="hljs-string">"#albums"</span>).empty();

          $db.view(<span class="hljs-string">"albums/albums"</span>,

            { success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

                    <span class="hljs-keyword">var</span> i;

                    <span class="hljs-keyword">var</span> album;

                    <span class="hljs-keyword">var</span> artist;

                    <span class="hljs-keyword">var</span> title;

                    <span class="hljs-keyword">var</span> description;

                    <span class="hljs-keyword">var</span> listItem;

                    <span class="hljs-keyword">for</span>( i <span class="hljs-keyword">in</span> data.rows )

                    {

                        album = data.rows[i].value;

                        artist = album.artist;

                        title = album.title;

                        description = album.description;

                        listItem = <span class="hljs-string">"&lt;li&gt;"</span> +

                                    <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span> +

                                    <span class="hljs-string">"&lt;p class=\"title\"&gt;gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> +

                                    <span class="hljs-string">"&lt;p class=\"description\"&gt;gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span>;

                        $(<span class="hljs-string">"#albums"</span>).append( listItem );

                    }

                    $(<span class="hljs-string">"#albums"</span>).listview( <span class="hljs-string">"refresh"</span> );

                }

            });

      }



      $(document).ready( handleDocumentReady );



  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>As it stands, the <strong>HTML</strong> that is constructed and appended as a list item to the <em>albums</em> list does not have any clickable navigation. As shown in previous examples, to add navigation to internal pages, we’ll add a link with an <strong>href</strong> to a page preceded by a hash (#) to each <em>listItem</em> <strong>HTML</strong> snippet.</p>
<h3 id="listitem-html">ListItem HTML</h3>
<p>Now we could just update the <strong>HTML</strong> string as such:</p>
<pre><code>listItem = "<span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>" +

                 "<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">\"#albumview\"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">\"artist\"</span>&gt;</span>gt;" + artist + "<span class="hljs-tag">&lt;<span class="hljs-title">\</span>/<span class="hljs-attribute">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">\</span>/<span class="hljs-attribute">a</span>&gt;</span>" +

                 "<span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">\"title\"</span>&gt;</span>gt;" + title + "<span class="hljs-tag">&lt;<span class="hljs-title">\</span>/<span class="hljs-attribute">p</span>&gt;</span>" +

                 "<span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">\"description\"</span>&gt;</span>gt;" + description + "<span class="hljs-tag">&lt;<span class="hljs-title">\</span>/<span class="hljs-attribute">p</span>&gt;</span>";
</code></pre><p>With the link wrapping the artist <em>header</em>, upon user-click the document would navigate to the <em>albumview</em> page. The problem with this solution is that the <em>albumview</em> is not populated with any content. We don’t know which list item was clicked or any other relevant information related to the target document. To access that, we’ll switch up how the <strong>HTML</strong> snippet is created and assign a <em>click</em> handler to each link in order to update a variable accessible between pages. </p>
<p>Make the following modifications the the <strong>HTML</strong> snippet within the for… loop of <em>refreshAlbums()</em>:</p>
<pre><code>for( i <span class="hljs-keyword">in</span> data<span class="hljs-preprocessor">.rows</span> )

{

    album = data<span class="hljs-preprocessor">.rows</span>[i]<span class="hljs-preprocessor">.value</span><span class="hljs-comment">;</span>

    artist = album<span class="hljs-preprocessor">.artist</span><span class="hljs-comment">;</span>

    title = album<span class="hljs-preprocessor">.title</span><span class="hljs-comment">;</span>

    description = album<span class="hljs-preprocessor">.description</span><span class="hljs-comment">;</span>

    listItem = $(<span class="hljs-string">"&lt;li/&gt;"</span>, {

                        class: <span class="hljs-string">"album"</span>

                    })<span class="hljs-comment">;</span>

    header = <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span><span class="hljs-comment">;</span>

    albumLink = $(<span class="hljs-string">"&lt;a/&gt;"</span>, {

                            href: <span class="hljs-string">"#albumview"</span>,

                            <span class="hljs-string">"data-identity"</span>: album._id,

                            click: function() {

                                albumId = $(this)<span class="hljs-preprocessor">.data</span>(<span class="hljs-string">"identity"</span>)<span class="hljs-comment">;</span>

                            }

                    })<span class="hljs-comment">;</span>

    albumLink<span class="hljs-preprocessor">.append</span>( header )<span class="hljs-comment">;</span>

    listItem<span class="hljs-preprocessor">.append</span>( albumLink )<span class="hljs-comment">;</span>

    listItem<span class="hljs-preprocessor">.append</span>( <span class="hljs-string">"&lt;p class=\"title\"&gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> )<span class="hljs-comment">;</span>

    listItem<span class="hljs-preprocessor">.append</span>( <span class="hljs-string">"&lt;p class=\"description\"&gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span> )<span class="hljs-comment">;</span>

    $(<span class="hljs-string">"#albums"</span>)<span class="hljs-preprocessor">.append</span>( listItem )<span class="hljs-comment">;</span>

}
</code></pre><p>In this snippet, we have resolved <em>listItem</em> to an <strong>HTML</strong> entity we can append to and construct a click-able <em>albumLink</em> using object notation. a <strong>data-identity</strong> property is set in the link to access and assign an <em>albumId</em> which will later be used to request the document once we have landed on the albumview page. The content elements are largely the same as they were previously for the <em>listItem</em>, but we have wrapped the header in a link element.</p>
<h3 id="navigation">Navigation</h3>
<p>We will need to bind an event prior to showing the albumview page in order to request the document and display it once we land on the <em>albumview</em> page. The following snippet is the full document with those changes highlighted:</p>
<pre><code><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>My Albums<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/main.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/jquery.mobile-1.0a2.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>/&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">h2</span>&gt;</span>Albums<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albums"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"listview"</span> <span class="hljs-attribute">data-theme</span>=<span class="hljs-value">"c"</span> <span class="hljs-attribute">data-dividertheme</span>=<span class="hljs-value">"b"</span> /&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumview"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumheader"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"albumtitle"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albumcontent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/couchapp/loader.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="javascript">



      <span class="hljs-keyword">var</span> albumId;

      $db = $.couch.db(<span class="hljs-string">"albums"</span>);



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleDocumentReady</span><span class="hljs-params">()</span>

      {</span>

          $(<span class="hljs-string">"#albumview"</span>).bind( <span class="hljs-string">"pagebeforeshow"</span>, openAlbum );

          refreshAlbums();

      }



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshAlbums</span><span class="hljs-params">()</span>

      {</span>

          $(<span class="hljs-string">"#albums"</span>).empty();

          $db.view(<span class="hljs-string">"albums/albums"</span>,

            { success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

                    <span class="hljs-keyword">var</span> i;

                    <span class="hljs-keyword">var</span> album;

                    <span class="hljs-keyword">var</span> artist;

                    <span class="hljs-keyword">var</span> title;

                    <span class="hljs-keyword">var</span> description;

                    <span class="hljs-keyword">var</span> listItem;

                    <span class="hljs-keyword">for</span>( i <span class="hljs-keyword">in</span> data.rows )

                    {

                        album = data.rows[i].value;

                        artist = album.artist;

                        title = album.title;

                        description = album.description;

                        listItem = $(<span class="hljs-string">"&lt;li/&gt;"</span>, {

                                        <span class="hljs-keyword">class</span>: <span class="hljs-string">"album"</span>

                                        });

                        header = <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span>;

                        albumLink = $(<span class="hljs-string">"&lt;a/&gt;"</span>, {

                                        href: <span class="hljs-string">"#albumview"</span>,

                                        <span class="hljs-string">"data-identity"</span>: album._id,

                                        click: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

                                                albumId = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"identity"</span>);

                                            }

                                        });

                        albumLink.append( header );

                        listItem.append( albumLink );

                        listItem.append( <span class="hljs-string">"&lt;p class=\"title\"&gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> );

                        listItem.append( <span class="hljs-string">"&lt;p class=\"description\"&gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span> );

                        $(<span class="hljs-string">"#albums"</span>).append( listItem );

                    }

                    $(<span class="hljs-string">"#albums"</span>).listview( <span class="hljs-string">"refresh"</span> );

                }

            });

      }



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openAlbum</span><span class="hljs-params">()</span>

      {</span>

          $(<span class="hljs-string">"#albumcontent"</span>).children().remove();

            $db.openDoc( albumId,

                  { success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

                          <span class="hljs-keyword">var</span> artist = data.artist;

                          <span class="hljs-keyword">var</span> title = data.title;

                          <span class="hljs-keyword">var</span> description = data.description;

                          <span class="hljs-keyword">var</span> html = <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span> +

                                        <span class="hljs-string">"&lt;p class=\"title\"&gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> +

                                        <span class="hljs-string">"&lt;p class=\"description\"&gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span>;

                          $(<span class="hljs-string">"#albumcontent"</span>).append( html );

                          $(<span class="hljs-string">"#albumheader .albumtitle"</span>).text( title );

                  }

              });

      }



      $(document).ready( handleDocumentReady );



  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>In this snippet we have bound the “<em>pagebefoeshow</em>” event to the <em>openAlbum()</em> method handler within the <em>handleDocumentReader()</em> method:</p>
<pre><code><span class="hljs-variable">$(</span><span class="hljs-string">"#albumview"</span>).bind( <span class="hljs-string">"pagebeforeshow"</span>, openAlbum );
</code></pre><p>This will invoke <em>openAlbum()</em> prior to transitioning to the <em>albumview</em> page, allowing us to request the document based on the <em>albumId</em> and add elements to the content of the <em>albumview</em> page:</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openAlbum</span><span class="hljs-params">()</span>

{</span>

    $(<span class="hljs-string">"#albumcontent"</span>).children().remove();

     $db.openDoc( albumId,

            { success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

                    <span class="hljs-keyword">var</span> artist = data.artist;

                    <span class="hljs-keyword">var</span> title = data.title;

                    <span class="hljs-keyword">var</span> description = data.description;

                    <span class="hljs-keyword">var</span> html = <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span> +

                                  <span class="hljs-string">"&lt;p class=\"title\"&gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> +

                                  <span class="hljs-string">"&lt;p class=\"description\"&gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span>;

                    $(<span class="hljs-string">"#albumcontent"</span>).append( html );

                    $(<span class="hljs-string">"#albumheader .albumtitle"</span>).text( title );

            }

        });

}
</code></pre><p>… nothing to unfamiliar… and nothing to pretty <img src="https://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)"> . </p>
<h3 id="deployment">Deployment</h3>
<p>We can now push our changes to the <a href="http://couchdb.apache.org/">CouchDB</a> database using the <a href="http://couchapp.org/page/index">couchapp</a> utliity. Open a terminal and navigate to the directory where you create your <strong>CouchApp</strong> applications (for me that is <em>/Documents/workspace/custardbelly/couchdb</em> and in there i have a folder named albums which is my <strong>CouchApp</strong> application directory). Enter the following command to push the changes to the <strong>CouchDB</strong> instance:</p>
<pre><code>couchapp push albums http:<span class="hljs-comment">//127.0.0.1:5984/albums</span>
</code></pre><p>If that was successful and you now visit <a href="http://127.0.0.1:5984/albums/_design/albums/index.html">http://127.0.0.1:5984/albums/_design/albums/index.html</a>, you will be presented with the list of albums. Click on a list item, and you should be navigated to the <em>albumview</em> page which will display the detail of the document selected from the list. It may look something like the following:</p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_four.png" alt=""></p>
<p>I intentionally left the browser wide (and not the simulated size of a mobile device) so you can how see the hash is added to the <strong>URL</strong> once on the <em>albumview</em> page: <a href="http://127.0.0.1:5984/albums/_design/albums/index.html#albumview">http://127.0.0.1:5984/albums/_design/albums/index.html#albumview</a>.</p>
<p>This is all well and good, but it leads to a problem (in my opinion) as to directly sending a user to the <em>albumview</em> with a populated document. As it stands, an album detail can only be seen once a user has clicked on an item from the list. If you just pasted the <a href="http://127.0.0.1:5984/albums/_design/albums/index.html#albumview">http://127.0.0.1:5984/albums/_design/albums/index.html#albumview</a> <strong>URL</strong> in a new browser window, the content would be empty. Not good User Experience.</p>
<p>Fortunately, there is an alternative. We can add a <em>show</em> function to our application in <strong>CouchDB</strong> to navigate to an external page that has a (somewhat) uglier URI but allows for you to land on a detail page without going through the landing page of the application. yay!</p>
<h2 id="external-album-page-view">External Album Page View</h2>
<p>In the browser, up to this point through the series, we have seen pages that return the JSON object representing rows of documents (ie. <a href="http://127.0.0.1:5984/albums/_all_docs">http://127.0.0.1:5984/albums/_all_docs</a>) and used design views to create a default landing page to interact with the albums database (<a href="http://127.0.0.1:5984/albums/_design/albums/index.html">http://127.0.0.1:5984/albums/_design/albums/index.html</a>). But there is more to <a href="http://couchdb.apache.org/">CouchDB</a>. Using <strong>shows and lists</strong>, you can serve up a document in any type of representation, including <strong>HTML</strong>. They are restricted to only <em>GET</em> requests, so you can’t save a document in a different format, but you can certainly return a document in another format.</p>
<p>If you look within the <em>/albums</em> directory we created using <a href="http://couchapp.org/page/index">CouchApp</a>, you may notice a couple folders we have largely been ignoring while we toiled away in _/<em>attachments</em> and <em>/vendor</em> – <em>shows</em> and <em>lists</em>. We are not going to look into lists at the moment, but we will create a <strong>show</strong> function in our application design to return the <strong>HTML</strong> representation of a document marked-up as a <a href="http://jquerymobile.com/">jquery Mobile</a> page. With this scenario, we can treat the <em>show</em> function as an external page view and have a ugl(ier)y URL, but one we can send to anyone and not have to go through list item selection from the main page.</p>
<h3 id="show-function">Show Function</h3>
<p>As we are moving away from internal pages to external pages for our application, we are going to have each page returned in a <strong>show function</strong> of our design. The first order of business to return a album detail page upon selection from the list, is to move the <strong>HTML</strong> markup for <em>albumview</em> into a show design document in the <em>/shows</em> directory of our <em>albums</em> <a href="http://couchapp.org/page/index">CouchApp</a> application.</p>
<p>Open up your favorite text editor and create a new <strong>JavaScript</strong> document. Enter in the following function and save it as <em>album.js</em> in the <em>/shows</em> folder:</p>
<pre><code>function(doc, req) <span class="hljs-special">{</span>

  var html = "&lt;div data-role=<span class="hljs-command">\"</span>page<span class="hljs-command">\"</span> id=<span class="hljs-command">\"</span>albumview<span class="hljs-command">\"</span>&gt;" +

                       "&lt;div data-role=<span class="hljs-command">\"</span>header<span class="hljs-command">\"</span> id=<span class="hljs-command">\"</span>albumheader<span class="hljs-command">\"</span>&gt;" +

                           "&lt;h2 class=<span class="hljs-command">\"</span>albumtitle<span class="hljs-command">\"</span>&gt;" + doc.title + "&lt;<span class="hljs-command">\/</span>h2&gt;" +

                       "&lt;<span class="hljs-command">\/</span>div&gt;" +

                       "&lt;div data-role=<span class="hljs-command">\"</span>content<span class="hljs-command">\"</span> id=<span class="hljs-command">\"</span>albumcontent<span class="hljs-command">\"</span>&gt;" +

                           "&lt;h2 class=<span class="hljs-command">\"</span>artist<span class="hljs-command">\"</span>&gt;" + doc.artist + "&lt;<span class="hljs-command">\/</span>h2&gt;" +

                           "&lt;p class=<span class="hljs-command">\"</span>title<span class="hljs-command">\"</span>&gt;" + doc.title + "&lt;<span class="hljs-command">\/</span>p&gt;" +

                           "&lt;p class=<span class="hljs-command">\"</span>description<span class="hljs-command">\"</span>&gt;" + doc.description + "&lt;<span class="hljs-command">\/</span>p&gt;" +

                       "&lt;<span class="hljs-command">\/</span>div&gt;" +

                       "&lt;div data-role=<span class="hljs-command">\"</span>footer<span class="hljs-command">\"</span> <span class="hljs-command">\/</span>&gt;" +

                   "&lt;<span class="hljs-command">\/</span>div&gt;";

  return html;

<span class="hljs-special">}</span>
</code></pre><p>Each <strong>show document</strong> must declare the <em>function(doc, reg)</em> method. This is the standard function of a <em>show document</em> which is invoked on a request through _<a href="http://127.0.0.1:5984/albums/_design/albums/_show/album/${_id}_">http://127.0.0.1:5984/albums/_design/albums/_show/album/${_id}_</a> and handed the full corresponding document from the database and the <strong>HTTP</strong> request object.</p>
<p>If we look at the <em>index.html</em> page we worked on in the previous section (<strong>Local Album Page View</strong>), we’ll see that what is returned from this <strong>show function</strong> is really just a mixture of the mark-up for the <em>albumview</em> page and the <em>openAlbum()</em> method. You may notice that we are not sending back a full <strong>HTML</strong> document from this <em>show</em> function. That is alright for now. This mark-up will be treated as a page and housed and styled by our <em>index.html</em> page. We can probably do some fancy string assembly based on the <em>request</em> path, but for now we are just gonna leave it as an insertion into the <a href="http://jquerymobile.com/">jquery Mobile</a> application.</p>
<h3 id="modifying-index-html">Modifying index.html</h3>
<p>Now that we have a <strong>show function</strong> serving up our <em>abumview</em> pages, we need to clean up our <em>index.html</em> document and change our <em>albumview</em> link from internal to external. Open up the _/<em>attachments/index.html</em> document in your favorite editor and make the following modifications:</p>
<pre><code><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>My Albums<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/main.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"style/jquery.mobile-1.0a2.css"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>/&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"page"</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"header"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">h2</span>&gt;</span>Albums<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"content"</span>&gt;</span>

              <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"albums"</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"listview"</span> <span class="hljs-attribute">data-theme</span>=<span class="hljs-value">"c"</span> <span class="hljs-attribute">data-dividertheme</span>=<span class="hljs-value">"b"</span> /&gt;</span>

          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-role</span>=<span class="hljs-value">"footer"</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/couchapp/loader.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="javascript">



      $db = $.couch.db(<span class="hljs-string">"albums"</span>);



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleDocumentReady</span><span class="hljs-params">()</span>

      {</span>

          refreshAlbums();

      }



      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshAlbums</span><span class="hljs-params">()</span>

      {</span>

          $(<span class="hljs-string">"#albums"</span>).empty();

          $db.view(<span class="hljs-string">"albums/albums"</span>,

            { success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

                    <span class="hljs-keyword">var</span> i;

                    <span class="hljs-keyword">var</span> album;

                    <span class="hljs-keyword">var</span> artist;

                    <span class="hljs-keyword">var</span> title;

                    <span class="hljs-keyword">var</span> description;

                    <span class="hljs-keyword">var</span> listItem;

                    <span class="hljs-keyword">var</span> externalPage;

                    <span class="hljs-keyword">for</span>( i <span class="hljs-keyword">in</span> data.rows )

                    {

                        album = data.rows[i].value;

                        artist = album.artist;

                        title = album.title;

                        description = album.description;

                        externalPage = <span class="hljs-string">"_show/album/"</span> + album._id;

                        listItem = <span class="hljs-string">"&lt;li class=\"album\"&gt;"</span> +

                                            <span class="hljs-string">"&lt;a href=\""</span> + externalPage + <span class="hljs-string">"\"&gt;"</span> +

                                                <span class="hljs-string">"&lt;h2 class=\"artist\"&gt;"</span> + artist + <span class="hljs-string">"&lt;\/h2&gt;"</span> +

                                            <span class="hljs-string">"&lt;\/a&gt;"</span> +

                                            <span class="hljs-string">"&lt;p class=\"title\"&gt;"</span> + title + <span class="hljs-string">"&lt;\/p&gt;"</span> +

                                            <span class="hljs-string">"&lt;p class=\"description\"&gt;"</span> + description + <span class="hljs-string">"&lt;\/p&gt;"</span>;

                                        <span class="hljs-string">"&lt;\/li&gt;"</span>;

                        $(<span class="hljs-string">"#albums"</span>).append( listItem );

                    }

                    $(<span class="hljs-string">"#albums"</span>).listview( <span class="hljs-string">"refresh"</span> );

                }

            });

      }



      $(document).ready( handleDocumentReady );



  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>There’s no highlighting for what we removed in that snippet, but we took out the <em>albumview</em> page declaration from the <em>body</em> and removed the <em>openAlbum()</em> method (as well as its binding on “<em>pagebeforeshow</em>“). The <em>listItem</em> is now back to an <strong>HTML</strong> string that is appending to the albums <em>listview</em>. Instead of adding a <em>click</em> handler to a link, the <strong>href</strong> is attributed as an external <a href="http://jquerymobile.com/">jQuery Mobile</a> page which is is a query to show the associated document with the _<em>id</em>. Simple, clean.</p>
<h3 id="deployment">Deployment</h3>
<p>We modified our application to utilize a <strong>show function</strong> to serve the <em>albumview</em> page up within a <a href="http://jquerymobile.com/">jquery Mobile</a> application. With these changes saved, we can now push to the <a href="http://couchdb.apache.org/">CouchDB</a> database using the <a href="http://couchapp.org/page/index">couchapp</a> utility. Open a terminal and navigate to the directory where you create your <strong>CouchApp</strong> applications (for me that is <em>/Documents/workspace/custardbelly/couchdb</em> and in there i have a folder named <em>albums</em> which is the <strong>CouchApp</strong> application directory for these examples). Enter the following command to push the changes to the <strong>CouchDB</strong> instance:</p>
<pre><code>couchapp push albums http:<span class="hljs-comment">//127.0.0.1:5984/albums</span>
</code></pre><p>If all was successful and you now go to <a href="http://127.0.0.1:5984/albums/_design/albums/index.html">http://127.0.0.1:5984/albums/_design/albums/index.html</a>, we’ll still have our old familiar list. Click on an item, and we should be navigated to a detail (or <em>albumview</em>) page somewhat like the following:</p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_five.png" alt=""></p>
<p>I left the browser wide again so you can see the new <strong>URL</strong> for viewing a single <em>album</em> document: <a href="http://127.0.0.1:5984/albums/_design/albums/index.html#_show/album/">http://127.0.0.1:5984/albums/_design/albums/index.html#_show/album/</a>${doc._id}. Pretty neat. Now you can even copy that <strong>#show</strong> page <strong>URL</strong> and paste it in another window and you should be taken directly to that detail page. You may notice that we still get the back button in the upper left of the header. That is because of the hash (#) in the <strong>URL</strong> which the <a href="http://jquerymobile.com/">jquery Mobile</a> framework interprets as being a page linked from another. So a false history. If you clicked <strong>Back</strong> from the page, it would not go to the <em>index.html</em> page. A minor flaw in our design that we are going to let go for now <img src="https://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)"> Hey, we just got all this neat stuff working… we’ll work out the kinks later. There’s more fun stuff to work on.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Well, i said the subsequent posts after the initial <a href="https://custardbelly.com/blog/?p=244">Getting Started</a> would be shorter… i lied <img src="https://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)"> In any event, we created a detail page for a single document and offloaded the page loading to an external <a href="http://jquerymobile.com/">jquery Mobile</a> page utilizing the <strong>show function</strong> of the albums design. A nice solution with an ugly<strong>URL</strong> (we can address that later) that can be passed to other people so they can land on that single page without going through the whole application from the beginning. Since I prefer the external page solution, any continuing posts on this example will utilize the <strong>show function</strong> to serve, at least, the album detail page.</p>
<p>Now what if we wanted to edit the fields of that document… I am on the edge of my seat as i write this. Literally. Someone stacked a bunch of wrapping stuff on this chair and left me little room. I could have moved it, but i was just too excited to talk about forms…</p>
<p><em>[Note] This post was written against the following software versions:</em><br><strong>CouchDB </strong>– 1.0.1<br><strong>CouchApp</strong> – 0.7.2<br><strong>jQuery</strong> – 1.4.4<br><strong>jQuery Mobile</strong> – 1.0a2<br><em>If you have found this post and any piece has moved forward, hopefully the examples are still viable/useful. I will not be updating the examples in this post in parellel with updates to any of the previously mentioned software, unless explicitly noted.</em></p>
<p><strong>Articles in this series:</strong></p>
<ol>
<li><a href="https://custardbelly.com/blog/?p=244">Getting Started</a></li>
<li><a href="https://custardbelly.com/blog/?p=278">Displaying a page detail of a single album.</a></li>
<li><a href="https://custardbelly.com/blog/?p=297">Templates and Mustache</a></li>
<li><a href="https://custardbelly.com/blog/?p=318">Displaying an editable page of an album.</a></li>
<li><a href="https://custardbelly.com/blog/?p=332">Creating and Adding an album document.</a></li>
<li><a href="https://custardbelly.com/blog/?p=344">Deleting an album document</a></li>
<li><a href="https://custardbelly.com/blog/?p=360">Authorization and Validation – Part 1</a></li>
<li><a href="https://custardbelly.com/blog/?p=394">Authorization and Validation – Part 2</a></li>
</ol>
<p><a href="https://custardbelly.com/downloads/couchapp/jqm_couchdb_albums.zip">Full source for albums couchapp here.</a></p>
<p>Posted in <a href="https://custardbelly.com/blog/category/couchdb/">CouchDB</a>, <a href="https://custardbelly.com/blog/category/jquery/">jquery</a>, <a href="https://custardbelly.com/blog/category/jquery-mobile/">jquery-mobile</a>.</p>

  </section>
  <section class="navigation">
      
        <span class="newer"><a href="/blog-posts/2010/12/28/jquery-mobile-couchdb-part-3-templates-and-mustache-js/index.html"><i class="fa fa-arrow-left"></i>&nbsp;newer posts</a></span>
      
      
        <span class="older"><a href="/blog-posts/2010/12/08/jquery-mobile-couchdb-part-1-getting-started/index.html">older posts&nbsp;<i class="fa fa-arrow-right"></i></a></span>
      
  </section>
  <section class="comments">
    
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        window.disqus_identifier="";
        window.disqus_url="https://www.custardbelly.com/blog/blog-posts/2010/12/13/jquery-mobile-couchdb-part-2-document-view/index.html";
        window.disqus_title="jQuery Mobile + CouchDB: Part 2 – Document View";
      </script>
        <script type="text/javascript" src="https://disqus.com/forums/custardbelly/embed.js"></script>
        <noscript><a href="http://custardbelly.disqus.com/?url=ref">View the discussion thread.</a></noscript>
    
  </section>
</article>
                </div>
              </section>
          </div>
      </div>
        <!-- Footer -->
          <section id="footer">
            <div class="container">
              <ul class="copyright">
                <li>&copy; Todd Anderson 2002-2017. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
              </ul>
            </div>
          </section>
      </div>

    <!-- Scripts -->
      <script src="/assets/js/jquery.min.js"></script>
      <script src="/assets/js/jquery.scrollzer.min.js"></script>
      <script src="/assets/js/jquery.scrolly.min.js"></script>
      <script src="/assets/js/skel.min.js"></script>
      <script src="/assets/js/util.js"></script>
      <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
      <script src="/assets/js/main.js"></script>
      <script src="/lib/highlight/highlight.pack.js"></script>
    <script>
        // custardbelly.com
        var _gaq=[["_setAccount","UA-29061897-1"],["_trackPageview"]];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
        g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
        s.parentNode.insertBefore(g,s)}(document,"script"));
   </script>

  </body>
</html>
