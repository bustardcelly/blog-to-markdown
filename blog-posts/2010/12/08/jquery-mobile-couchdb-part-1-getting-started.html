
	
	<h1 class="entry-title full-title"><a href="http://custardbelly.com/blog/2010/12/08/jquery-mobile-couchdb-part-1-getting-started/" title="Permanent link to jquery Mobile + CouchDB: Part 1 – Getting Started" rel="bookmark" rev="post-244">jquery Mobile + CouchDB: Part 1 – Getting Started</a></h1>
	
	<div class="entry-content full-content">
		<h2>Intro</h2>
<p>I have been digging using <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a> as my back-end choice for personal projects for a while now and truly do believe it is the best solution when choosing a non-relational database management system. While discovering my affinity for <strong>CouchDB</strong>, i started developing <a href="http://custardbelly.com/blog/?page_id=127" target="_blank">as3couchdb</a> – an open-source library written in <strong>ActionScript 3</strong> that allows <strong>Flash</strong> to communicate to a <strong>CouchDB</strong> instance which can be found on <a href="https://github.com/bustardcelly/as3couchdb" target="_blank">github</a>. I think <strong>as3couchdb</strong> is in a pretty stable place at the moment and have built a couple applications and have been happy with it. I am going to continue developing it, and if you do use it and find problems/suggestions please let me know.</p>
<p>That said, i have never been one to focus on something for too long (without getting paid to, of course <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"> ), without getting distracted by wanting to learn something new. I knew <strong>CouchDB</strong> shipped with a <a href="http://jquery.com/" target="_blank">jQuery</a> <a href="https://github.com/apache/couchdb/blob/trunk/share/www/script/jquery.couch.js" target="_blank">plugin</a>, so i thought i would play around with making a <strong>DHTML</strong> client for some of my projects. Then i thought, why the hell not throw in the <a href="http://jquerymobile.com/" target="_blank">jquery Mobile</a> framework for the fun of it? If we are gonna do it, let’s do it. </p>
<p>So that is what i have set out to do. I have finished some basics of an application and am looking to get more into the nitty gritty. I figured what better way to do this than to document it; not only purposed as a storage of how to do something, but *hopefully* a place for some people to chime in and tell me how to do it better <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  </p>
<p>This happens to be the first in a series of posts that document building a “simple” <strong>DHTML</strong> application using the <a href="http://jquerymobile.com/" target="_blank">jQuery  Mobile</a> framework and a <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a> back-end. <em>Here’s to hoping the intro for subsequent posts are not as long.</em></p>
<h2>CouchDB</h2>
<p><a href="http://couchdb.apache.org/" target="_blank">CouchDB</a> is a schema-free document-oriented database HTTP server. If you have not heard the term <a href="http://en.wikipedia.org/wiki/NoSQL" target="_blank">NoSQL</a>, it is used to refer to a database management system (<strong>DBMS</strong>) that differs from the widely-used relational model; started out as meaning a <strong>DBMS</strong> that does not providing a <strong>SQL</strong> interface, but became a term to refer to any non-relational <strong>DBMS</strong>, of which <strong>CouchDB</strong> is often grouped with when talking about <strong>NoSQL</strong>. I won’t go into a lengthy discussion of <strong>CouchDB</strong> – so I will say, in basic terms, <strong>CouchDB</strong> is a document-based <strong>DBMS</strong>. This will make more sense once we start looking at the API for the <strong>CouchDB</strong> <strong>jQuery</strong> plugin.</p>
<p>Before we get into building a front-end for our application, we need to set up a database to play around with. I am assuming here that you have installed <strong>CouchDB</strong> on your local machine and have it running and accessible at <a href="http://127.0.0.1:5984" target="_blank">http://127.0.0.1:5984</a>. If you don’t and want to set it up, <a href="http://couchdb.apache.org/downloads.html" target="_blank">download CouchDB</a> and peruse the appendix on this link – <a href="http://guide.couchdb.org/draft" target="_blank">http://guide.couchdb.org/draft</a> – or install from source from this link -<a href="http://guide.couchdb.org/draft/source.html" target="_blank">http://guide.couchdb.org/draft/source.html</a></p>
<h2>CouchApp</h2>
<p>Though it is not necessary in creating and modifying views and <strong>DHTML</strong> pages served up from <strong>CouchDB</strong>, i tend to use the <a href="http://couchapp.org/page/index" target="_blank">CouchApp</a> command line tool when working with and managing a <strong>CouchDB</strong> database. </p>
<p>You can read more about <strong>CouchApp</strong> on their <a href="http://couchapp.org/page/index" target="_blank">main wiki</a> and checkout the project at <a href="https://github.com/couchapp/couchapp" target="_blank">/couchapp/couchapp on github</a>. <strong>CouchApp</strong> is basically a set of utilities that makes creating and modifying views of a <strong>CouchDB</strong> database instance easy (or i should say <em>easier</em>). Not to mention (the best part), you can create all your views, etc locally, make sure you got it right then push replication remotely and you are all set. Beauty.</p>
<p>When pushing design documents to a <strong>CouchDB</strong> database in this and following example posts, I will be using the <strong>couchapp</strong> command line tool as it is quick and easy and a great little utility, but everything done with it can be easily done using <a href="http://curl.haxx.se/docs/manpage.html" target="_blank">curl</a> if you wish.</p>
<h2>Our Album Database</h2>
<p>First things first, let’s set up a database we can start working with. I use <a href="http://janl.github.com/couchdbx/" target="_blank">CouchDBX</a>, which i recommend if you are on a <strong>Mac</strong>. Don’t know if there is an equivalent for <strong>Windows</strong> or <strong>Linux</strong>, so if you do know, leave a comment please. Otherwise, just hitting up <a href="http://127.0.0.1:5984/_utils" target="_blank">http://127.0.0.1:5984/_utils</a>, the <strong>Futon</strong> app, should work in getting started.</p>
<p>Create a new database called <em>albums</em>… or whatever you want to call it. I will be building <em>album</em> views in these examples but you could easily make them something else. Once we have our <em>albums</em> database created, lets create a couple <em>album</em> documents since we are going to have a view that shows a list of albums. The make up of an <em>album</em> document is as such:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript plain">{</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"artist"</code> <code class="jscript plain">: {</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"type"</code> <code class="jscript plain">: </code><code class="jscript string">"string"</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"title"</code> <code class="jscript plain">: {</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"type"</code> <code class="jscript plain">: </code><code class="jscript string">"string"</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"description"</code> <code class="jscript plain">: {</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"type"</code> <code class="jscript plain">: </code><code class="jscript string">"string"</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number11 index10 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>… pretty basic for our purposes. Using that schema, add a couple album documents to the databse. I just threw in the following document entries:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript plain">{</code><code class="jscript string">"artist"</code><code class="jscript plain">:</code><code class="jscript string">"Thin Lizzy"</code><code class="jscript plain">, </code><code class="jscript string">"title"</code><code class="jscript plain">:</code><code class="jscript string">"Fighting"</code><code class="jscript plain">, </code><code class="jscript string">"description"</code><code class="jscript plain">:</code><code class="jscript string">"Bona-fide rock classic."</code><code class="jscript plain">}</code></div><div class="line number2 index1 alt1"><code class="jscript plain">{</code><code class="jscript string">"artist"</code><code class="jscript plain">:</code><code class="jscript string">"David Bowie"</code><code class="jscript plain">, </code><code class="jscript string">"title"</code><code class="jscript plain">:</code><code class="jscript string">"Honky Dory"</code><code class="jscript plain">, </code><code class="jscript string">"description"</code><code class="jscript plain">:</code><code class="jscript string">"Doesn't get much better than this."</code><code class="jscript plain">}</code></div></pre></div>
<p> … and now you know a little bit about my musical tastes <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  Any way, we’ve got our database and a few documents residing in it. Lets create a client-side application using <a href="http://couchapp.org/page/index" target="_blank">CouchApp</a> and push it to the <em>albums</em> database. </p>
<h2>Our Albums CouchApp</h2>
<p>With <a href="https://github.com/couchapp/couchapp" target="_blank">CouchApp</a> properly installed, we’ll move over to using the command line tools to create our <strong>Albums</strong> application, create views and push the documents to our <strong>CouchDB</strong> database.</p>
<h3>Application</h3>
<p>With the terminal open, navigate to a directory that you deem worthy to create applications for <strong>CouchDB</strong> in. For example, on <strong>Mac</strong>, that for me is usually <em>/Documents/workspace/custardbelly/couchdb</em>. Enter in the following command to generate an <em>albums</em> application to which we will add some views and later push to the <em>albums</em> database:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">couchapp generate app albums</code></div></pre></div>
<p>If all goes well, a new folder named <em>albums</em> will be in the target directory and will contain files such as the following:</p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_one.png" alt="couch app application diretory"></p>
<p>I won’t cover all of what those files pertain to, but basically those files will be pushed to the <em>albums</em> database and stored based on the <em>_id</em> file value – <strong>CouchApp</strong> defaults to <em>_design/${application}</em> and for this example will be <em>_design/albums</em>.</p>
<p>Now, if we were to push this application to our <strong>CouchDB</strong> database as it stands now and visited <a href="http://127.0.0.1:5984/albums/_all_docs" target="_blank">http://127.0.0.1:5984/albums/_all_docs</a> we would get returned a page that shows the <strong>JSON</strong> object of rows of available documents with the default key/values. Maybe useful to some, but not a good user experience for looking at documents in our database. To do this we can create a view using <strong>CouchApp</strong> that will help in presenting a page that lists the available documents in a nice readable manner.</p>
<h3>View</h3>
<p>In the terminal, enter the following command to generate a view for all albums in the database:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">couchapp generate view albums albums</code></div></pre></div>
<p>With that command, we have used <strong>CouchApp</strong> to create a view named <em>albums</em> (the last argument) in the database <em>albums</em> (argument after <strong>view</strong>). If you take a look at the views directory in the <em>albums application</em> folder, you will see that a new folder called <em>albums</em> has been created containing the <em>map.js</em> and <em>reduce.js</em> files. </p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_two.png" alt="couch app application diretory"></p>
<p>I won’t go over all that is involved in map/reduce in <strong>CouchDB</strong>, so this is some good information if you are interested: <a href="http://wiki.apache.org/couchdb/Introduction_to_CouchDB_views" target="_blank">http://wiki.apache.org/couchdb/Introduction_to_CouchDB_views</a>. For now, we are just going to modify the<em> map.js</em> file and delete the <em>reduce.js</em> file so it returns a list of the album documents in the database.</p>
<h3>map.js</h3>
<p>Open up the <em>/albums/views/albums/map.js</em> file in you favorite text editor and add the following line within the <em>function()</em> statement:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript keyword">function</code><code class="jscript plain">( doc ) {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">emit( doc._id, doc );</code></div><div class="line number3 index2 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>When you visit <a href="http://127.0.0.1:5984/albums/_design/albums/_view/albums" target="_blank">http://127.0.0.1:5984/albums/_design/albums/_view/albums</a> a <strong>JSON</strong> object will be returned with a key/value pairing for each document in the database with the key being the <em>_id</em> assigned to the document and the value being the full document object. In essence, when you create a view, you are creating a rule of how you want documents from the database returned to you. For this simple example, we are just going to return all the documents trusting that they will all be albums. You can create more views (and more applications) as you see fit. For now, we’ll just work with all the documents and wire up a page to view them.</p>
<p>Let’s go ahead and push the <em>albums</em> application to our albums database:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">couchapp push albums http:</code><code class="bash plain">//127</code><code class="bash plain">.0.0.1:5984</code><code class="bash plain">/albums</code></div></pre></div>
<p>If successful, that should return:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">2010-12-06 17:37:24 [INFO] Visit your CouchApp here:</code></div><div class="line number2 index1 alt1"><code class="bash plain">http:</code><code class="bash plain">//127</code><code class="bash plain">.0.0.1:5984</code><code class="bash plain">/albums/_design/albums/index</code><code class="bash plain">.html</code></div></pre></div>
<p>If you go and visit <a href="http://127.0.0.1:5984/albums/_design/albums/index.html" target="_blank">http://127.0.0.1:5984/albums/_design/albums/index.html</a>, you will notice that shows absolutely no relevance to our application or our database <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  If you go to <a href="http://127.0.0.1:5984/albums/_design/albums/_view/albums" target="_blank">http://127.0.0.1:5984/albums/_design/albums/_view/albums</a> you will now see our full <strong>JSON</strong> object that we will use when we modify that <em>index.html</em>. </p>
<p>The index file that you were originally directed to is the <em>index.html</em> file in the <em>/albums/_attachments</em> directory. If you open that file up in a text editor, you will see that it is using the <strong>couch.app</strong> <strong>jQuery</strong> plugin to construct the elements on the default page. We can modify this <strong>HTML</strong> document now and use the <strong>jQuery Mobile</strong> plugin to present our list of albums beautifully (no guarantees on the beautiful part:)).</p>
<h2>Albums Application User Interface</h2>
<p><a href="http://couchdb.apache.org/" target="_blank">CouchDB</a> ships with a version of <a href="http://jquery.com/" target="_blank">jQuery</a> and a plugin to interact with a <strong>CouchDB</strong> instance. They (and other scripts for serialization and <strong>futon</strong>) can be found in your installation, which on my make is in the following location:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">/opt/local/share/couchdb/www/script</code></div></pre></div>
<p>If we look at the default <em>index.html</em> page created for us when we used <strong>CouchApp</strong> to create our <em>albums</em> application, we see that it is using a loader to load in all those necessary scripts:</p>
<div><pre><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;My New CouchApp&lt; </code><code class="xml keyword">itle</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/main.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">link</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"account"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">h1</code><code class="xml plain">&gt;Generated CouchApp&lt;/</code><code class="xml keyword">h1</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"profile"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"items"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"sidebar"</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">p</code><code class="xml plain">&gt;Edit welcome message.&lt;/</code><code class="xml keyword">p</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">p</code><code class="xml plain">&gt;Ideas: You could easily turn this into a photo sharing app, or a grocery list, or a chat room.&lt;/</code><code class="xml keyword">p</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number18 index17 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">src</code><code class="xml plain">=</code><code class="xml string">"vendor/couchapp/loader.js"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number20 index19 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/javascript"</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">&gt;</code></div><div class="line number21 index20 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$.couch.app(function(app) {</code></div><div class="line number22 index21 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#account").evently("account", app);</code></div><div class="line number23 index22 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#profile").evently("profile", app);</code></div><div class="line number24 index23 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$.evently.connect("#account","#profile", ["loggedIn","loggedOut"]);</code></div><div class="line number25 index24 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#items").evently("items", app);</code></div><div class="line number26 index25 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">});</code></div><div class="line number27 index26 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number28 index27 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></pre></div>
<p>That <em>loader.js</em> file can be found in the <em>/albums/vendor/couchapp/_attachments</em> directory and looks like the following:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript keyword">function</code> <code class="jscript plain">couchapp_load(scripts) {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">for</code> <code class="jscript plain">(</code><code class="jscript keyword">var</code> <code class="jscript plain">i=0; i &lt; scripts.length; i++) {</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">document.write(</code><code class="jscript string">'&lt;script src="'</code><code class="jscript plain">+scripts[i]+</code><code class="jscript string">'"&gt;&lt; \/script&gt;'</code><code class="jscript plain">)</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number5 index4 alt2"><code class="jscript plain">};</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="jscript plain">couchapp_load([</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/sha1.js"</code><code class="jscript plain">,</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/json2.js"</code><code class="jscript plain">,</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/jquery.js"</code><code class="jscript plain">,</code></div><div class="line number11 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/jquery.couch.js"</code><code class="jscript plain">,</code></div><div class="line number12 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.couch.app.js"</code><code class="jscript plain">,</code></div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.couch.app.util.js"</code><code class="jscript plain">,</code></div><div class="line number14 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.mustache.js"</code><code class="jscript plain">,</code></div><div class="line number15 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.evently.js"</code></div><div class="line number16 index15 alt1"><code class="jscript plain">]);</code></div></pre></div>
<p>As we intend to use <a href="http://jquerymobile.com/" target="_blank">jQuery Mobile</a> for our user interface, we will modify this <em>loader.js</em> file to include the latest <a href="http://jquery.com/" target="_blank">jQuery</a> libray and the <a href="http://jquerymodile.com/" target="_blank">jQuery Mobile</a> plugin.</p>
<h3>Modifying loader.js</h3>
<p>If you have not already done so, download the latest releases of <a href="http://jquery.com/" target="_blank">jQuery</a> and <a href="http://jquerymobile.com/">jQuery Mobile</a>. As of this writing those are:</p>
<ol>
<li>
jQuery-1.4.4.js
</li>
<li>
jQuery.mobile-1.0a2.js
</li>
</ol>
<p>Copy those files from wherever you downloaded them to into the <em>/albums/vendor/couchapp/_attachments/</em> directory.</p>
<p>Open up <em>loader.js</em> from that same directory in you favorite text editor and make the following changes:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript keyword">function</code> <code class="jscript plain">couchapp_load(scripts) {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">for</code> <code class="jscript plain">(</code><code class="jscript keyword">var</code> <code class="jscript plain">i=0; i &lt; scripts.length; i++) {</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">document.write(</code><code class="jscript string">'&lt;script src="'</code><code class="jscript plain">+scripts[i]+</code><code class="jscript string">'"&gt;&lt; \/script&gt;'</code><code class="jscript plain">)</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number5 index4 alt2"><code class="jscript plain">};</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="jscript plain">couchapp_load([</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/sha1.js"</code><code class="jscript plain">,</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/json2.js"</code><code class="jscript plain">,</code></div><div class="line number10 index9 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery-1.4.4.js"</code><code class="jscript plain">,</code></div><div class="line number11 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"/_utils/script/jquery.couch.js"</code><code class="jscript plain">,</code></div><div class="line number12 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.couch.app.js"</code><code class="jscript plain">,</code></div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.couch.app.util.js"</code><code class="jscript plain">,</code></div><div class="line number14 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.mustache.js"</code><code class="jscript plain">,</code></div><div class="line number15 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.evently.js"</code><code class="jscript plain">,</code></div><div class="line number16 index15 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript string">"vendor/couchapp/jquery.mobile-1.0a2.js"</code></div><div class="line number17 index16 alt2"><code class="jscript plain">]);</code></div></pre></div>
<p>Save the changes to <em>loader.js</em>. We could probably get rid of the <em>mustache.js</em> and <em>evently.js</em> includes, but we’ll forget about that for now.</p>
<p>Now that we have our loader loading the proper scripts to display a <strong>jQuery Mobile</strong> interface, we need to modify the <em>index.html</em> file to display the list of <em>album</em> documents from our <strong>CouchDB</strong> database.</p>
<h3>Modifying index.html</h3>
<p>Firstly, we’ll need to add the necessary css and image files that came with the <strong>jQuery Mobile</strong> download so we get the default look-and-feel. </p>
<p>Copy the <em>jquery.mobile-1.0.a2.css</em> file and the <em>images/</em> directory from your <strong>jQuery Mobile</strong> download into the <em>/albums/_attachments/style/</em> folder (residing along with the default <em>main.css</em> file generated using <strong>CouchApp</strong>).</p>
<p>Open up the <em>index.html</em> file in the <em>/albums/_attachments</em> directory with your favorite text editor, and start off with a clean slate by removing the inline <strong>JavaScript</strong> and <em>div</em> tags in the body of the <strong>HTML</strong> document. Also declare the <em>jquery.mobile-1.0a2.css</em> file in your stylesheets. The <em>index.html</em> file should now look somewhat like the following:</p>
<div><pre><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;My Albums&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/main.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/jquery.mobile-1.0a2.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">src</code><code class="xml plain">=</code><code class="xml string">"vendor/couchapp/loader.js"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/javascript"</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">&gt;</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></pre></div>
<h3>JQuery Mobile Page</h3>
<p>This post is already getting pretty long as it is, and i don’t want to discuss the finer parts of <a href="http://jquerymobile.com/" target="_blank">jQuery Mobile</a> so the following modifications might not have the fullest explanations as to why we are adding some elements, but i will try at times to explain. </p>
<p>To begin, a <strong>jQuery Mobile</strong> application is comprised of <em>pages</em>. You can declare all your <em>pages</em> in a single <strong>HTML</strong> document or load other pages (saved as <strong>HTML</strong> documents) into <em>divs</em>. A page is denoted by a <strong>data-role</strong> attribute with the value of <em>“page”</em>. The <strong>jQuery Mobile</strong> framework handles this pagination and its browser history for you, so there isn’t much to worry about except for how you want you pages to look… well there is more to worry about, but we won’t for the time being <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
<p>The landing page for our <em>albums</em> application will display the list of album documents. To do so, modify the <em>index.html</em> file by adding a page <em>div</em> to the <em>body</em> of the <strong>HTML</strong> document:</p>
<div><pre><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;My Albums&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/main.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/jquery.mobile-1.0a2.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"page"</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"header"</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">h2</code><code class="xml plain">&gt;Albums&lt;/</code><code class="xml keyword">h2</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"content"</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">ul</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"albums"</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"listview"</code> <code class="xml color1">data-theme</code><code class="xml plain">=</code><code class="xml string">"c"</code> <code class="xml color1">data-dividertheme</code><code class="xml plain">=</code><code class="xml string">"b"</code> <code class="xml plain">/&gt;</code></div><div class="line number12 index11 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"footer"</code><code class="xml plain">&gt;Footer&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">src</code><code class="xml plain">=</code><code class="xml string">"vendor/couchapp/loader.js"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/javascript"</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">&gt;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number20 index19 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></pre></div>
<p>The make up of a <strong>jQuery Mobile</strong> page contains a <em>content</em> div and optional <em>header</em> and <em>footer</em> divs. In this example we have included the <em>header</em> and <em>footer</em> with some very basic information. What is of note is the <em>content</em> div (marked with the <strong>data-role</strong> of “<em>content</em>“). The content of our landing page is a list maked with a <strong>data-role</strong> of “<em>listview</em>” which will be populated with the document result form our <strong>CouchDB</strong> database query for all album documents.</p>
<p>With our <strong>jQuery Mobile</strong> elements in place, we will add the <strong>JavaScript</strong> to communicate with our <strong>CouchDB</strong> instance and request the <em>album</em> documents from our <em>albums</em> database.</p>
<h3>Communication</h3>
<p>As mentioned previously, <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a> ships with a <a href="http://jquery.com/" target="_blank">jquery</a> plugin to ease the communication with a <strong>CouchDB</strong> instance. That script (<em>jquery.couch.js</em>) along with scripts for serialization are loaded within the <em>loader.js</em>.</p>
<p>First things first, we need to assign a handler for when the document has become available and we declare our database reference as the <em>albums</em> database form the <strong>CouchDB</strong> instance:</p>
<div><pre><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;My Albums&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/main.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/jquery.mobile-1.0a2.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"page"</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"header"</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">h2</code><code class="xml plain">&gt;Albums&lt;/</code><code class="xml keyword">h2</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"content"</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">ul</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"albums"</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"listview"</code> <code class="xml color1">data-theme</code><code class="xml plain">=</code><code class="xml string">"c"</code> <code class="xml color1">data-dividertheme</code><code class="xml plain">=</code><code class="xml string">"b"</code> <code class="xml plain">/&gt;</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"footer"</code><code class="xml plain">&gt;Footer&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">src</code><code class="xml plain">=</code><code class="xml string">"vendor/couchapp/loader.js"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/javascript"</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">&gt;</code></div><div class="line number18 index17 alt1 highlighted">&nbsp;</div><div class="line number19 index18 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$db = $.couch.db("albums");</code></div><div class="line number20 index19 alt1 highlighted">&nbsp;</div><div class="line number21 index20 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">function handleDocumentReady()</code></div><div class="line number22 index21 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{</code></div><div class="line number23 index22 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">// request album documents...</code></div><div class="line number24 index23 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">}</code></div><div class="line number25 index24 alt2 highlighted">&nbsp;</div><div class="line number26 index25 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$(document).ready( handleDocumentReady );</code></div><div class="line number27 index26 alt2 highlighted">&nbsp;</div><div class="line number28 index27 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number29 index28 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></pre></div>
<p>The <a href="http://docs.jquery.com/Tutorials:Introducing_$(document).ready()" target="_blank">$(document).ready()</a> event hook is a standard part of <a href="http://jquery.com/" target="_blank">jQuery</a> to recognize when the <strong>DOM</strong> has been loaded and we can begin any operations/transactions. In this example, the <em>handleDocumentReady()</em> method is defined as the handler for that event. Within that handler we will add the communication with the <em>$db</em> instance to request our album documents and add them to the <em>listview</em> of the content.</p>
<p>The following snippet is a full implementation of making a request for those documents and adding them to the <em>listview</em>:</p>
<div><pre><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;My Albums&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/main.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">link</code> <code class="xml color1">rel</code><code class="xml plain">=</code><code class="xml string">"stylesheet"</code> <code class="xml color1">href</code><code class="xml plain">=</code><code class="xml string">"style/jquery.mobile-1.0a2.css"</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/css"</code><code class="xml plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"page"</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"header"</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">h2</code><code class="xml plain">&gt;Albums&lt;/</code><code class="xml keyword">h2</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"content"</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">ul</code> <code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"albums"</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"listview"</code> <code class="xml color1">data-theme</code><code class="xml plain">=</code><code class="xml string">"c"</code> <code class="xml color1">data-dividertheme</code><code class="xml plain">=</code><code class="xml string">"b"</code> <code class="xml plain">/&gt;</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">div</code> <code class="xml color1">data-role</code><code class="xml plain">=</code><code class="xml string">"footer"</code><code class="xml plain">&gt;Footer&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">div</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">src</code><code class="xml plain">=</code><code class="xml string">"vendor/couchapp/loader.js"</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">script</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text/javascript"</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">&gt;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$db = $.couch.db("albums");</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">function handleDocumentReady()</code></div><div class="line number22 index21 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{</code></div><div class="line number23 index22 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">refreshAlbums();</code></div><div class="line number24 index23 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">}</code></div><div class="line number25 index24 alt2 highlighted">&nbsp;</div><div class="line number26 index25 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">function refreshAlbums()</code></div><div class="line number27 index26 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{</code></div><div class="line number28 index27 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#albums").empty();</code></div><div class="line number29 index28 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$db.view("albums/albums",</code></div><div class="line number30 index29 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{ success: function( data ) {</code></div><div class="line number31 index30 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var i;</code></div><div class="line number32 index31 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var album;</code></div><div class="line number33 index32 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var artist;</code></div><div class="line number34 index33 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var title;</code></div><div class="line number35 index34 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var description;</code></div><div class="line number36 index35 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">var listItem;</code></div><div class="line number37 index36 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">for( i in data.rows )</code></div><div class="line number38 index37 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{</code></div><div class="line number39 index38 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">album = data.rows[i].value;</code></div><div class="line number40 index39 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">artist = album.artist;</code></div><div class="line number41 index40 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">title = album.title;</code></div><div class="line number42 index41 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">description = album.description;</code></div><div class="line number43 index42 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">listItem = "&lt;</code><code class="xml keyword">li</code><code class="xml plain">&gt;" +</code></div><div class="line number44 index43 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">"&lt;</code><code class="xml keyword">h2</code> <code class="xml plain">class=\"artist\"&gt;gt;" + artist + "&lt;\/h2&gt;" +</code></div><div class="line number45 index44 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">"&lt;</code><code class="xml keyword">p</code> <code class="xml plain">class=\"title\"&gt;gt;" + title + "&lt;\/p&gt;" +</code></div><div class="line number46 index45 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">"&lt;</code><code class="xml keyword">p</code> <code class="xml plain">class=\"description\"&gt;gt;" + description + "&lt;\/p&gt;";</code></div><div class="line number47 index46 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#albums").append( listItem );</code></div><div class="line number48 index47 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">}</code></div><div class="line number49 index48 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$("#albums").listview( "refresh" );</code></div><div class="line number50 index49 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">}</code></div><div class="line number51 index50 alt2 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">});</code></div><div class="line number52 index51 alt1 highlighted"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">}</code></div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">$(document).ready( handleDocumentReady );</code></div><div class="line number55 index54 alt2">&nbsp;</div><div class="line number56 index55 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">script</code><code class="xml plain">&gt;</code></div><div class="line number57 index56 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></pre></div>
<p>To get a deeper view, lets look in detail at the method that handles loading the album documents in the script which is invoked from the <em>handleDocumentReady(</em>) handler:</p>
<div><pre><div class="line number27 index0 alt2"><code class="jscript keyword">function</code> <code class="jscript plain">refreshAlbums()</code></div><div class="line number28 index1 alt1"><code class="jscript plain">{</code></div><div class="line number29 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).empty();</code></div><div class="line number30 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$db.view(</code><code class="jscript string">"albums/albums"</code><code class="jscript plain">,</code></div><div class="line number31 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">{ success: </code><code class="jscript keyword">function</code><code class="jscript plain">( data ) {</code></div><div class="line number32 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i;</code></div><div class="line number33 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">album;</code></div><div class="line number34 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">artist;</code></div><div class="line number35 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">title;</code></div><div class="line number36 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">description;</code></div><div class="line number37 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">listItem;</code></div><div class="line number38 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">for</code><code class="jscript plain">( i </code><code class="jscript keyword">in</code> <code class="jscript plain">data.rows )</code></div><div class="line number39 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">{</code></div><div class="line number40 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">album = data.rows[i].value;</code></div><div class="line number41 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">artist = album.artist;</code></div><div class="line number42 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">title = album.title;</code></div><div class="line number43 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">description = album.description;</code></div><div class="line number44 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listItem = </code><code class="jscript string">"&lt;li&gt;"</code> <code class="jscript plain">+</code></div><div class="line number45 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;h2 class=\"artist\"&gt;"</code> <code class="jscript plain">+ artist + </code><code class="jscript string">"&lt;\/h2&gt;"</code> <code class="jscript plain">+</code></div><div class="line number46 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;p class=\"title\"&gt;"</code> <code class="jscript plain">+ title + </code><code class="jscript string">"&lt;\/p&gt;"</code> <code class="jscript plain">+</code></div><div class="line number47 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;p class=\"description\"&gt;"</code> <code class="jscript plain">+ description + </code><code class="jscript string">"&lt;\/p&gt;"</code><code class="jscript plain">;</code></div><div class="line number48 index21 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).append( listItem );</code></div><div class="line number49 index22 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number50 index23 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).listview( </code><code class="jscript string">"refresh"</code> <code class="jscript plain">);</code></div><div class="line number51 index24 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number52 index25 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number53 index26 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>First and foremost, as we might use this method in later implementations of the application to refresh the list, we make a call to empty the content of the <em>listview</em>:</p>
<div><pre><div class="line number29 index0 alt2"><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).empty();</code></div></pre></div>
<p>Following that, we request the <em>albums</em> view from the database instance by calling <strong>$db.view()</strong> and pointing to the <em>albums</em> view that we created and pushed to the <strong>CouchDB</strong> database using <strong>CouchApp</strong>.</p>
<div><pre><div class="line number30 index0 alt1"><code class="jscript plain">$db.view(</code><code class="jscript string">"albums/albums"</code></div></pre></div>
<p>… and then resolve a successful result to a function that handles interpreting each <strong>JSON</strong> object related to to an album document so as to add them as list items to the <em>listview</em>:</p>
<div><pre><div class="line number31 index0 alt2"><code class="jscript plain">{ success: </code><code class="jscript keyword">function</code><code class="jscript plain">( data ) {</code></div><div class="line number32 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i;</code></div><div class="line number33 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">album;</code></div><div class="line number34 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">artist;</code></div><div class="line number35 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">title;</code></div><div class="line number36 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">description;</code></div><div class="line number37 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">listItem;</code></div><div class="line number38 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">for</code><code class="jscript plain">( i </code><code class="jscript keyword">in</code> <code class="jscript plain">data.rows )</code></div><div class="line number39 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">{</code></div><div class="line number40 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">album = data.rows[i].value;</code></div><div class="line number41 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">artist = album.artist;</code></div><div class="line number42 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">title = album.title;</code></div><div class="line number43 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">description = album.description;</code></div><div class="line number44 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listItem = </code><code class="jscript string">"&lt;li&gt;"</code> <code class="jscript plain">+</code></div><div class="line number45 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;h2 class=\"artist\"&gt;"</code> <code class="jscript plain">+ artist + </code><code class="jscript string">"&lt;\/h2&gt;"</code> <code class="jscript plain">+</code></div><div class="line number46 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;p class=\"title\"&gt;"</code> <code class="jscript plain">+ title + </code><code class="jscript string">"&lt;\/p&gt;"</code> <code class="jscript plain">+</code></div><div class="line number47 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">"&lt;p class=\"description\"&gt;"</code> <code class="jscript plain">+ description + </code><code class="jscript string">"&lt;\/p&gt;"</code><code class="jscript plain">;</code></div><div class="line number48 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).append( listItem );</code></div><div class="line number49 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number50 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">"#albums"</code><code class="jscript plain">).listview( </code><code class="jscript string">"refresh"</code> <code class="jscript plain">);</code></div><div class="line number51 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number52 index21 alt1"><code class="jscript plain">}</code></div></pre></div>
<p>The <em>for..in</em> loop in this example goes reads each document object and appends a list item to the <em>listview</em>, after which we make a call to <strong>refresh</strong> the view.</p>
<h3>Deployment</h3>
<p>With the <em>index.html</em> file modified and ready to go live, we can use the couchapp utility to push an update to the <strong>CouchDB</strong> instance so we can view our new mobile-based application in a browser:</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">couchapp push albums http:</code><code class="bash plain">//127</code><code class="bash plain">.0.0.1:5984</code><code class="bash plain">/albums</code></div></pre></div>
<p>.. if all goes well you should see the following printed out :</p>
<div><pre><div class="line number1 index0 alt2"><code class="bash plain">2010-12-07 11:46:55 [INFO] Visit your CouchApp here:</code></div><div class="line number2 index1 alt1"><code class="bash plain">http:</code><code class="bash plain">//127</code><code class="bash plain">.0.0.1:5984</code><code class="bash plain">/albums/_design/albums/index</code><code class="bash plain">.html</code></div></pre></div>
<p>Now, if you do visit that link, it should redirect you to <a href="http://127.0.0.1:5984/albums/_design/albums/index.html" target="_blank">http://127.0.0.1:5984/albums/_design/albums/index.html</a> and you should see something like the following:</p>
<p><img src="http://www.custardbelly.com/blog/images/couchapp_three.png" alt="couch app mobile application"></p>
<p>Pretty, no? No. But maybe in later posts we can modify that. For now its up and running. yay!</p>
<h2>Conclusion</h2>
<p>Well, if you made it this far down, you have been a trooper. Hopefully this has been of some help in getting up and started using <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a>, <a href="http://couchapp.org/page/index" target="_blank">CouchApp</a> and <a href="http://jquerymobile.com/" target="_blank">jQuery Mobile</a> to provide a mobile-based <em>User Interface</em> for documents in a <strong>CouchDB</strong> database. Since this is the first in a series of posts in working with <strong>jQuery Mobile</strong> and <strong>CouchDB</strong> it is pretty lengthy as it addresses set-up and the beginning of an application of which we can continue to work. Good news is, later posts on this topic will be shorter <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  and address more of the finer details of <strong>jQuery Mobile</strong> and <strong>CouchDB</strong> communication. At least that is the hope <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"> .</p>
<h2>Future Topics</h2>
<p>I am looking forward to adding more posts for this topic as i go about discovering how to create a mobile-based solution for working with documents from a <strong>CouchDB</strong> database. The tentative list is as follows:</p>
<ol>
<li><a href="http://custardbelly.com/blog/?p=244" target="_blank">Getting Started</a></li>
<li><a href="http://custardbelly.com/blog/?p=278" target="_blank">Displaying a page detail of a single album.</a></li>
<li><a href="http://custardbelly.com/blog/?p=297" target="_blank">Templates and Mustache</a></li>
<li><a href="http://custardbelly.com/blog/?p=318" target="_blank">Displaying an editable page of an album.</a></li>
<li><a href="http://custardbelly.com/blog/?p=332" target="_blank">Creating and Adding an album document.</a></li>
<li><a href="http://custardbelly.com/blog/?p=344" target="_blank">Deleting an album document</a></li>
<li><a href="http://custardbelly.com/blog/?p=360" target="_blank">Authorization and Validation – Part 1</a></li>
<li><a href="http://custardbelly.com/blog/?p=394">Authorization and Validation – Part 2</a></li>
</ol>
<p><a href="http://custardbelly.com/downloads/couchapp/jqm_couchdb_albums.zip">Full source for albums couchapp here.</a></p>
<p>As those post go live, this list will be updated with the related links.</p>
<p><em>[Note] This post was written against the following software versions:</em><br>
<strong>CouchDB</strong> – 1.0.1<br>
<strong>CouchApp</strong> – 0.7.2<br>
<strong>jQuery</strong> – 1.4.4<br>
<strong>jQuery Mobile</strong> – 1.0a2<br>
<em>If you have found this post and any piece has moved forward, hopefully the examples are still viable/useful. I will not be updating the examples in this post in parellel with updates to any of the previously mentioned software, unless explicitly noted.</em></p>
		<div class="clear"></div>
	</div><!-- .entry-content-->
	
	<p class="filed categories alt-font tight">Posted in <a href="http://custardbelly.com/blog/category/couchdb/" title="View all posts in CouchDB" rel="category tag">CouchDB</a>,  <a href="http://custardbelly.com/blog/category/jquery/" title="View all posts in jquery" rel="category tag">jquery</a>,  <a href="http://custardbelly.com/blog/category/jquery-mobile/" title="View all posts in jquery-mobile" rel="category tag">jquery-mobile</a>.</p>
	
	

	<!--/by-line-->

	<div id="post-comments-244-target"></div>
	<div class="clear"></div>
	
	