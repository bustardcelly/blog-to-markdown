
	
	<h1 class="entry-title full-title"><a href="http://custardbelly.com/blog/2013/01/17/the-making-of-a-test-driven-grocery-list-application-in-js-part-vii/" title="Permanent link to The Making of a Test-Driven Grocery List Application in JS: Part VII" rel="bookmark" rev="post-742">The Making of a Test-Driven Grocery List Application in JS: Part VII</a></h1>
	
	<div class="entry-content full-content">
		<p><em>This is the seventh installment in a series of building a Test-Driven Grocery List application using <a href="http://pivotal.github.com/jasmine/" target="_blank">Jasmine</a> and <a href="http://requirejs.org" target="_blank">RequireJS</a>. To learn more about the intent and general concept of the series please visit <a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-javascript-part-i/">The Making of a Test-Driven Grocery List Application in JavaScript: Part I</a></em><br>
—</p>
<h2>Introduction</h2>
<p>In the <a href="http://custardbelly.com/blog/2013/01/08/the-making-of-a-test-driven-grocery-list-application-in-js-part-vi/" target="_blank">previous article</a> we resolved tests for the <em>Mark Off Item</em> feature that were left in a failing state after refactoring the list-controller. The test are all green now and the application usable, but we are not done with implementing the required features. In this article I plan to address another – the <em>Remove Item</em> feature.</p>
<p>Before we begin, let’s drum up a quick story and scenario(s) for the <em>Remove Item</em> feature. I know the feature seems a little simple – just remove an item from the list – and going through and adding stories and scenarios may appear like adding complexity to the situation, but since I have begun to incorporate such a workflow, I feel like it actually gives me more time to think about not only the necessity of the feature but the design; in result, <em>hopefully*</em> cutting down on the complexity of the code.</p>
<p><em>// story</em><br>
<strong>Feature:</strong> remove item from grocery list</p>
<p><strong>In order to</strong> not buy an item previous on a grocery list<br>
<strong>As a</strong> grocery shopper<br>
<strong>I want to</strong> remove the existence of the item on the grocery list<br>
—</p>
<p>That may be worded rather harshly, but I shop angry. It’s how I keep the cantelope in check. <em>‘I see you looking at me, you lousy melon.’</em> All kidding aside, I tend to be a little more terse in describing stories so as not to mince words (no pun intended) and leave as little vagueness as possible. Sometimes, I’ll admit, there is no avoiding having the story lead to a lot of assumptions – but that is where scenarios come in.</p>
<p><em>// spec</em><br>
<strong>Scenario 1:</strong> Item removed from grocery list<br>
<strong>Given</strong> an item has been added to the list<br>
<strong>When</strong> a user requests to remove the item<br>
<strong>Then</strong> the list decreases in size by one</p>
<p>Hmm. Pretty straight forward. Well, it all seems rather easy going to implement this feature. Looks like it might be a short blog post, for once; we’ll see how much rambling I can pack in. At least we have something to show somebody who doesn’t want/need to read code when they ask, <em>‘But, what does it do?’</em>.</p>
<h2>Tests</h2>
<p>As always, before we get into adding code to the components of the application to implement the new feature, let’s get some failing tests to pass. We’ll start of with defining a new spec suite for the <em>Remove Item</em> feature, with the setup (<code>beforeEach()</code>) being the <strong>Given</strong> describe above:</p>
<p><em>/test/jasmine/spec/feature/removeitem.spec.js</em></p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript plain">define([</code><code class="jscript string">'jquery'</code><code class="jscript plain">, </code><code class="jscript string">'script/controller/list-controller'</code><code class="jscript plain">], </code><code class="jscript keyword">function</code><code class="jscript plain">($, listController) {</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">describe(</code><code class="jscript string">'Remove item'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">$listView = $(</code><code class="jscript string">'&lt;ul/&gt;'</code><code class="jscript plain">),</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">groceryItem;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">beforeEach( </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.setView($listView);</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">groceryItem = listController.createNewItem();</code></div><div class="line number11 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">it(</code><code class="jscript string">'should remove existing item from the collection'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number14 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(</code><code class="jscript keyword">false</code><code class="jscript plain">).toEqual(</code><code class="jscript keyword">true</code><code class="jscript plain">);</code></div><div class="line number15 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">afterEach( </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number18 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">groceryItem = undefined;</code></div><div class="line number19 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>Don’t mind the expectation declared in the spec. <a href="http://pivotal.github.com/jasmine/" target="_blank">Jasmine</a> does not check empty specs and automatically fail them. In fact, if we ran it without any expectations defined, it would be all green. So, I usually drop a failing expectation in quickly when creating new specs in cases where someone/thing comes and interrupts me, I know where to pick back up when i come back. It’s habit. Maybe a little paranoia. Don’t know if it’s right or wrong <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"><br>
<small><br>
If you have been following along in the articles of this series, I typically do my implementation in the tests then move them to their respective modules. It’s a nice workflow for me, and in most cases I feel it gets me more focused on design. In this case, I am just going to declare my expectations, see them fail and move over to implementing the code right in the module, running the spec runner as we go until we see green.<br>
</small></p>
<p>Anyway, first on the agenda is to verify that the Remove API from <code>list-controller</code> is expected to remove the item from the underlying collection of grocery list items:</p>
<p><em>/test/jasmine/spec/feature/removeitem.spec.js</em></p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript plain">it(</code><code class="jscript string">'should remove existing item from the collection'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">collection = listController.getItemList(),</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">removedItem;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">removedItem = listController.removeItem(groceryItem);</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">expect(removedItem).toBe(groceryItem);</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">expect(collection.getItemIndex(groceryItem)).toBe(-1);</code></div><div class="line number9 index8 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>Add the new spec to the spec runner:<br>
<em>/test/jasmine/specrunner.html</em></p>
<div><pre><div class="line number34 index0 alt1 highlighted"><code class="jscript plain">require( [</code><code class="jscript string">'spec/feature/additem.spec.js'</code><code class="jscript plain">, </code><code class="jscript string">'spec/feature/markitem.spec.js'</code><code class="jscript plain">, </code><code class="jscript string">'spec/feature/removeitem.spec.js'</code><code class="jscript plain">,</code></div><div class="line number35 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'spec/list-controller.spec.js'</code><code class="jscript plain">, </code><code class="jscript string">'spec/list-item-controller.spec.js'</code><code class="jscript plain">, </code><code class="jscript string">'spec/grocery-ls-item.spec.js'</code><code class="jscript plain">,</code></div><div class="line number36 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'spec/collection.spec.js'</code><code class="jscript plain">], </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number37 index3 alt2">&nbsp;</div><div class="line number38 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">jasmineEnv = jasmine.getEnv(),</code></div><div class="line number39 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">...</code></div><div class="line number40 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">jasmineEnv.execute();</code></div><div class="line number41 index7 alt2">&nbsp;</div><div class="line number42 index8 alt1"><code class="jscript plain">});</code></div></pre></div>
<p>Run that, and we have a big honking failure:<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_1.png" alt="Failing remove spec on collection."><br>
Good!</p>
<p>In looking at the expectations of the <code>removeItem()</code> method on <code>list-controller</code>, we are expecting that the item is removed from the collection and returned on invocation. Let’s implement <code>removeItem</code> on <code>list-controller</code> with this understanding:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number6 index0 alt1"><code class="jscript plain">listController = {</code></div><div class="line number7 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$view: undefined,</code></div><div class="line number8 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">getItemList: </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number9 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">collection;</code></div><div class="line number10 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number11 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">getRendererFromItem: </code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number12 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">i = rendererList.itemLength();</code></div><div class="line number13 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">while</code><code class="jscript plain">( --i &gt; -1 ) {</code></div><div class="line number14 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(rendererList.getItemAt(i).model === item) {</code></div><div class="line number15 index9 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">rendererList.getItemAt(i);</code></div><div class="line number16 index10 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number17 index11 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">undefined;</code></div><div class="line number18 index12 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number19 index13 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number20 index14 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">createNewItem: </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number21 index15 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model = modelFactory.create();</code></div><div class="line number22 index16 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">collection.addItem(model);</code></div><div class="line number23 index17 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">model;</code></div><div class="line number24 index18 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number25 index19 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">removeItem: </code><code class="jscript keyword">function</code><code class="jscript plain">(item) {</code></div><div class="line number26 index20 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">collection.removeItem(item);</code></div><div class="line number27 index21 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">},</code></div><div class="line number28 index22 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">setView: </code><code class="jscript keyword">function</code><code class="jscript plain">(view) {</code></div><div class="line number29 index23 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.$view = (view </code><code class="jscript keyword">instanceof</code> <code class="jscript plain">$) ? view : $(view);</code></div><div class="line number30 index24 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number31 index25 alt2"><code class="jscript plain">};</code></div></pre></div>
<p>Run it, and we pass!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_2.png" alt="Passing tests on remove from collection."><br>
Well, that was sort of easy and anti-climatic. No drama. A little boring, if I may say so.</p>
<p>But… there’s more! The <code>list-controller</code> isn’t just some dumb facade to the underlying <strong>Grocery List</strong> collection – it also manages the associated renderers to the <code>grocery-ls-item</code> models. Let’s get back to our tests and add a new spec:</p>
<p><em>/test/jasmine/spec/feature/removeitem.spec.js</em></p>
<div><pre><div class="line number23 index0 alt2"><code class="jscript plain">it(</code><code class="jscript string">'should remove item renderer from view'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number24 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(groceryItem);</code></div><div class="line number25 index2 alt2">&nbsp;</div><div class="line number26 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">expect($listView.children().length).toEqual(0);</code></div><div class="line number27 index4 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>Just as we had done for the <em>Add Item</em> feature specification, we are inspecting the view reference held by list-controller that is updated based on change to the model. In this case, we are expecting that the list item renderer is removed upon <code>removeItem()</code> as well.</p>
<p>Run that, and failure!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_3.png" alt="Failure of test on removl of item views."><br>
It might be important to note the actual print out from the failing expectation. It says that the length of children on the list view is 2 – that is because we now have 2 specs that are defining the expectations of <code>removeItem()</code> that are failing to remove the item view from the list.</p>
<p>Let’s switch over the list-controller and get this sorted and back to green. But before we do, let’s think about the relationship of the <code>list-controller</code> and its underlying collection. The <code>list-controller</code> responds to collection event for <code>EventKindEnum.ADD</code> in order to modify the view. So, we will respond to <code>EventKindEnum.REMOVE</code> accordingly to modify the view on removal of an item as well, instead of adding more logic to the <code>removeItem()</code> method on <code>list-controller</code>:</p>
<p><em>/script/controller/list-controller.js</em></p>
<div><pre><div class="line number40 index0 alt1"><code class="jscript plain">$collection.on(</code><code class="jscript string">'collection-change'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number41 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model, itemController, $itemView;</code></div><div class="line number42 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">switch</code><code class="jscript plain">( event.kind ) {</code></div><div class="line number43 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.ADD:</code></div><div class="line number44 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = $(</code><code class="jscript string">'&lt;li&gt;'</code><code class="jscript plain">);</code></div><div class="line number45 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number46 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = itemControllerFactory.create($itemView, model);</code></div><div class="line number47 index7 alt2">&nbsp;</div><div class="line number48 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.appendTo(listController.$view);</code></div><div class="line number49 index9 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.addItem(itemController);</code></div><div class="line number50 index10 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.state = itemControllerFactory.state.EDITABLE;</code></div><div class="line number51 index11 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number52 index12 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.REMOVE:</code></div><div class="line number53 index13 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number54 index14 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = listController.getRendererFromItem(model);</code></div><div class="line number55 index15 alt2 highlighted">&nbsp;</div><div class="line number56 index16 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(itemController) {</code></div><div class="line number57 index17 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = itemController.parentView;</code></div><div class="line number58 index18 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.remove();</code></div><div class="line number59 index19 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.removeItem(itemController);</code></div><div class="line number60 index20 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number61 index21 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number62 index22 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.RESET:</code></div><div class="line number63 index23 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number64 index24 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number65 index25 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>In the <code>EventKindEnum.REMOVE</code> case, we are grabbing the model provided on the event, using it to access the associated <code>list-item-controller</code> instance, and – if defined – removing the list item renderer view from the DOM and the controller from the renderer collection.</p>
<p>Run that, and we are back to green!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_4.png" alt="Passing tests on removal of item from view."></p>
<p>Tagged <strong>0.1.10</strong>: <a href="https://github.com/bustardcelly/grocery-ls/tree/0.1.10" target="_blank">https://github.com/bustardcelly/grocery-ls/tree/0.1.10</a></p>
<h2>Back to Reality</h2>
<p>We’ve got test for the removal of a grocery list item working. We are currently feature complete. Let’s ship it! But hold up, does the <strong>Grocery List</strong> application – the thing we are actually building for someone like myself to Use in real life – actually use the new Remove API. We defined a business feature that was a requirement to have, and met that expectation, but we really didn’t address how an item is removed, or under what circumstances…</p>
<p>Without getting to crazy on discussing how to handle swipe gestures and implementing press-and-hold menu actions, let’s just start with saying that the <code>list-item-controller</code> will dispatch a new event – <code>remove</code>. How we decide on the usability of an item being deleted could easily be another whole discussion on User Experience. For now, we want to verify that when a <code>list-item-controller</code> dispatches a <code>remove</code> event, that it is handled properly.</p>
<h3>Tests</h3>
<p>We’ll start with the specs for the <code>list-controller</code>. We are not going to be adding any new specs to the <em>Remove Item</em> feature to accomplish the implementation of <code>list-item-controller</code> notifying of a <code>remove</code> event; it seems a little odd to me as well, but we have already established that the <em>Remove</em> API performs as expected. We need to verify that the <code>list-controller</code> uses that API in response to a <code>list-item-controller</code> – less of a feature and more of an integration point.</p>
<p><em>/test/jasmine/spec/list-controller.spec.js</em></p>
<div><pre><div class="line number0 index0 alt1 break"><code class="jscript plain">describe(</code><code class="jscript string">'list-item-controller remove event response'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number1 index1 alt2">&nbsp;</div><div class="line number2 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">it(</code><code class="jscript string">'should invoke list-controller:removeItem()'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number3 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">newItem = listController.createNewItem(),</code></div><div class="line number4 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemRenderer = listController.getRendererFromItem(newItem);</code></div><div class="line number5 index5 alt2">&nbsp;</div><div class="line number6 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">spyOn(listController, </code><code class="jscript string">'removeItem'</code><code class="jscript plain">);</code></div><div class="line number7 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(itemRenderer).trigger(</code><code class="jscript string">'remove'</code><code class="jscript plain">);</code></div><div class="line number8 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">expect(listController.removeItem).toHaveBeenCalledWith(newItem);</code></div><div class="line number9 index9 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number10 index10 alt1">&nbsp;</div><div class="line number11 index11 alt2"><code class="jscript plain">});</code></div></pre></div>
<p>In this spec, we set up a <a href="https://github.com/pivotal/jasmine/wiki/Spies" target="_blank">spy</a> to verify that the <code>removeItem()</code> method is invoked upon dispatch of <code>remove</code> from a <code>list-item-controller</code> instance.</p>
<p>Run that and we are back to red, with a message letting us know that <code>removeItem()</code> was never called.<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_5.png" alt="Failing implementation of remove event."><br>
Good. Let’s open up <code>list-controller</code> and implement a <code>remove</code> event response:</p>
<p>/script/controller/list-controller.js</p>
<div><pre><div class="line number40 index0 alt1"><code class="jscript plain">$collection.on(</code><code class="jscript string">'collection-change'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number41 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">model, itemController, $itemView;</code></div><div class="line number42 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">switch</code><code class="jscript plain">( event.kind ) {</code></div><div class="line number43 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.ADD:</code></div><div class="line number44 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = $(</code><code class="jscript string">'&lt;li&gt;'</code><code class="jscript plain">);</code></div><div class="line number45 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number46 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = itemControllerFactory.create($itemView, model);</code></div><div class="line number47 index7 alt2">&nbsp;</div><div class="line number48 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.appendTo(listController.$view);</code></div><div class="line number49 index9 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.addItem(itemController);</code></div><div class="line number50 index10 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.state = itemControllerFactory.state.EDITABLE;</code></div><div class="line number51 index11 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(itemController).on(</code><code class="jscript string">'remove'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number52 index12 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">listController.removeItem(model);</code></div><div class="line number53 index13 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number54 index14 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number55 index15 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.REMOVE:</code></div><div class="line number56 index16 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">model = event.items.shift();</code></div><div class="line number57 index17 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController = listController.getRendererFromItem(model);</code></div><div class="line number58 index18 alt1">&nbsp;</div><div class="line number59 index19 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(itemController) {</code></div><div class="line number60 index20 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView = itemController.parentView;</code></div><div class="line number61 index21 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$itemView.remove();</code></div><div class="line number62 index22 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">itemController.dispose();</code></div><div class="line number63 index23 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(itemController).off(</code><code class="jscript string">'remove'</code><code class="jscript plain">);</code></div><div class="line number64 index24 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">rendererList.removeItem(itemController);</code></div><div class="line number65 index25 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number66 index26 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number67 index27 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">case</code> <code class="jscript plain">EventKindEnum.RESET:</code></div><div class="line number68 index28 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number69 index29 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number70 index30 alt1"><code class="jscript plain">});</code></div></pre></div>
<p>We added the remove handler delegation in the <code>ADD</code> case when the collection changes, along with the other implementation of item renderer establishment. And, for good measure and memory management, we are sure to remove the event handler in the <code>REMOVE</code> case from the collection change, as well.</p>
<p>Run the test now and we are back to green!<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_6.png" alt="Passing remove event response."></p>
<h3>list-item-controller Modification</h3>
<p>That’s great, but we are still glazing over the usability aspect: <em>How does a User delete an item?</em></p>
<p>Again, we could go into a lengthy discussion of UX and code implementations, but to save yourself from scrolling just to read me ramble off topic, we’ll keep it simple: <em>add a delete button</em>! I don’t know why I got excited there. I’ll show the implementation in piecemeal just to see how it all comes together. First we’ll start with the markup we declared for the <code>list-item-controller</code> views:</p>
<p><em>/script/controller/list-item-controller.js</em></p>
<div><pre><div class="line number56 index0 alt1 highlighted"><code class="jscript plain">uneditableItemFragment&nbsp; = </code><code class="jscript string">'&lt;p class="grocery-item"&gt;'</code> <code class="jscript plain">+</code></div><div class="line number57 index1 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;span class="grocery-item-label" /&gt;'</code> <code class="jscript plain">+</code></div><div class="line number58 index2 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;button class="delete-item-button"&gt;delete&lt;/button&gt;'</code> <code class="jscript plain">+</code></div><div class="line number59 index3 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;/p&gt;'</code><code class="jscript plain">,</code></div><div class="line number60 index4 alt1"><code class="jscript plain">editableItemFragment&nbsp;&nbsp;&nbsp; = </code><code class="jscript string">'&lt;p class="editable-grocery-item"&gt;'</code> <code class="jscript plain">+</code></div><div class="line number61 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;input name="editableItem" '</code> <code class="jscript plain">+</code></div><div class="line number62 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'class="editable-item" placeholder="Enter item name..."&gt;'</code> <code class="jscript plain">+</code></div><div class="line number63 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;/input&gt;'</code> <code class="jscript plain">+</code></div><div class="line number64 index8 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript string">'&lt;/p&gt;'</code></div></pre></div>
<p>The <code>uneditableItemFragment</code> markup has changed slightly to support a label and a button. It was previously just a <code>p</code> element all by its lonesome, but with several references for modification and event <code>click</code> event handling. We’ll need to update those, as well as add another event handler for the <code>button</code> element:</p>
<p><em>/script/controller/list-item-controller.js</em></p>
<div><pre><div class="line number68 index0 alt1"><code class="jscript plain">init: </code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number69 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.$editableView = $(editableItemFragment);</code></div><div class="line number70 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.$uneditableView = $(uneditableItemFragment);</code></div><div class="line number71 index3 alt2">&nbsp;</div><div class="line number72 index4 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript comments">// view handlers.</code></div><div class="line number73 index5 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'span.grocery-item-label'</code><code class="jscript plain">, </code><code class="jscript keyword">this</code><code class="jscript plain">.$uneditableView).on(</code><code class="jscript string">'click'</code><code class="jscript plain">, (</code><code class="jscript keyword">function</code><code class="jscript plain">(controller) {</code></div><div class="line number74 index6 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number75 index7 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">toggled = $(</code><code class="jscript keyword">this</code><code class="jscript plain">).css(</code><code class="jscript string">'text-decoration'</code><code class="jscript plain">) === </code><code class="jscript string">'line-through'</code><code class="jscript plain">;</code></div><div class="line number76 index8 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">controller.model.marked = !toggled;</code></div><div class="line number77 index9 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number78 index10 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}(</code><code class="jscript keyword">this</code><code class="jscript plain">)));</code></div><div class="line number79 index11 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'button.delete-item-button'</code><code class="jscript plain">, </code><code class="jscript keyword">this</code><code class="jscript plain">.$uneditableView).on(</code><code class="jscript string">'click'</code><code class="jscript plain">, (</code><code class="jscript keyword">function</code><code class="jscript plain">(controller) {</code></div><div class="line number80 index12 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript keyword">function</code><code class="jscript plain">(event) {</code></div><div class="line number81 index13 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(controller).trigger(createRemoveEvent(controller));</code></div><div class="line number82 index14 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">};</code></div><div class="line number83 index15 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}(</code><code class="jscript keyword">this</code><code class="jscript plain">)));</code></div><div class="line number84 index16 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">...</code></div><div class="line number85 index17 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>As seen previously, we are using <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank">IIFE</a>s here as a factory method in order to pass in a reference to the <code>list-item-controller</code> instance instead of declaring the old:</p>
<div><pre><div class="line number1 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">self = </code><code class="jscript keyword">this</code><code class="jscript plain">;</code></div></pre></div>
<p>and then passing <code>self</code> around which always makes me cringe. In any event (no pun intended), we have transferred the <em>click</em> handling previously assigned to the <code>p</code> element over the <code>span</code> element in order to support the usability of marking off an item. As well, we added handling of delete <code>button</code> <em>click</em> to trigger a new event:</p>
<p><em>/script/controller/list-item-controller.js</em></p>
<div><pre><div class="line number10 index0 alt1"><code class="jscript keyword">function</code> <code class="jscript plain">createRemoveEvent(controller) {</code></div><div class="line number11 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">event = $.Event(</code><code class="jscript string">'remove'</code><code class="jscript plain">);</code></div><div class="line number12 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">event.controller = controller;</code></div><div class="line number13 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">return</code> <code class="jscript plain">event;</code></div><div class="line number14 index4 alt1"><code class="jscript plain">}</code></div></pre></div>
<p>Pretty straight forward in how we have create factory methods for our <a href="http://jquery.org" target="_blank">jQuery</a> events previously in this series. Next we need to modify the references that respond to model changes, such as the <code>marked</code> property value:</p>
<p><em>/script/controller/list-item-controller.js</em></p>
<div><pre><div class="line number16 index0 alt1"><code class="jscript keyword">function</code> <code class="jscript plain">handlePropertyChange(controller, event) {</code></div><div class="line number17 index1 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">(event.property === </code><code class="jscript string">"name"</code><code class="jscript plain">) {</code></div><div class="line number18 index2 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// update view based on model change.</code></div><div class="line number19 index3 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'input'</code><code class="jscript plain">, controller.$editableView).val(controller.model.name);</code></div><div class="line number20 index4 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'span.grocery-item-label'</code><code class="jscript plain">, controller.$uneditableView).text(event.newValue);</code></div><div class="line number21 index5 alt2"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number22 index6 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript keyword">else</code> <code class="jscript keyword">if</code><code class="jscript plain">(event.property === </code><code class="jscript string">"marked"</code><code class="jscript plain">) {</code></div><div class="line number23 index7 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// update view based on model change.</code></div><div class="line number24 index8 alt1 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$(</code><code class="jscript string">'span.grocery-item-label'</code><code class="jscript plain">, controller.$uneditableView)</code></div><div class="line number25 index9 alt2 highlighted"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">.css(</code><code class="jscript string">'text-decoration'</code><code class="jscript plain">, ( event.newValue ) ? </code><code class="jscript string">'line-through'</code> <code class="jscript plain">: </code><code class="jscript string">'none'</code><code class="jscript plain">);</code></div><div class="line number26 index10 alt1"><code class="jscript spaces">&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number27 index11 alt2"><code class="jscript plain">}</code></div></pre></div>
<p>Alright. That should just about do it. Now you may be saying to yourself, <em>‘Why haven’t we modified any tests in order to support this change in UI and event handling?’</em> To which I will respond, <em>‘Stop bringing that up!’</em> In all seriousness, we perhaps should be writing tests to support these changes, however those will get pretty fine grained on the UI design aspect of the application. As you can see, it is constantly changing at this time and we are more concerned with the logical points of how the <strong>Grocery List</strong> application should behave. </p>
<p><small>Like with most of my code, future me may look back and shake his head at past me for such a statement – but for right now, present me will live with it</small> <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
<h3>Using the Grocery List Application</h3>
<p>Let’s actually <em>run</em> the application and use it. We spend all this time making our tests turn red and green, we barely get to use what we are building.<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_7.png" alt="Grocery list application"></p>
<p>Oh my… that is ugly to look at. But it works! And it’s backed by tests!</p>
<p>Because I can’t leave well enough alone, I added some quick styling just to make it a little more pleasant on the eyes. I am not designer, so it might not be any more pleasant to you <img src="http://custardbelly.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley">  I won’t go into the styling of the application as that could be a whole ‘nother article and discussion of box model, but feel free to mess around with the styling on your own…<br>
<img src="http://custardbelly.com/blog/images/tdd_js/part_vii_8.png" alt="Prettier Grocery List application"></p>
<p>Tagged <strong>0.1.11</strong>: <a href="https://github.com/bustardcelly/grocery-ls/tree/0.1.11" target="_blank">https://github.com/bustardcelly/grocery-ls/tree/0.1.11</a></p>
<h2>Conclusion</h2>
<p>In this article of the series, we took more of a traditional approach to <a href="http://en.wikipedia.org/wiki/Test-driven_development" target="_blank">TDD</a> and went along making things turn <span style="color: red;">red</span> before they turn <span style="color: green;">green</span>, one spec at a time, and all the while implementing the <em>Remove Item</em> feature. </p>
<p>The <strong>Grocery List</strong> application is also coming along pretty nicely and, as always, is easy and ready to use. But I can’t leave well enough alone and there are a few more items on my list (no pun intended) that I wish to address before ending this series, most importantly persistence. Our grocery list only last within the session of the page – once closed, our list is gone. We’ll get to that, but there might be some other things to address beforehand.</p>
<p>Cheers for sticking around!</p>
<p>—</p>
<h1>Link Dump</h1>
<h2>Reference</h2>
<p><a href="http://tddjs.com/" target="_blank">Test-Driven JavaScript Development by Christian Johansen</a><br>
<a href="http://dannorth.net/introducing-bdd/" target="_blank">Introducing BDD by Dan North</a><br>
<a href="http://requirejs.org/" target="_blank">RequireJS</a><br>
<a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank">AMD</a><br>
<a href="http://pivotal.github.com/jasmine/" target="_blank">Jasmine</a><br>
<a href="http://sinonjs.org/" target="_blank">Sinon</a><br>
<a href="https://github.com/derickbailey/jasmine.async" target="_blank">Jasmine.Async</a></p>
<h2>Post Series</h2>
<p><a href="https://github.com/bustardcelly/grocery-ls">grocery-ls github repo</a><br>
<a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-javascript-part-i" target="_blank">Part I – Introduction</a><br>
<a href="http://custardbelly.com/blog/2012/11/26/the-making-of-a-test-driven-grocery-list-application-in-js-part-ii">Part II – Feature: Add Item</a><br>
<a href="http://custardbelly.com/blog/2012/12/06/the-making-of-a-test-driven-grocery-list-application-in-js-part-iii">Part III – Feature: Mark-Off Item</a><br>
<a href="http://custardbelly.com/blog/2012/12/17/the-making-of-a-test-driven-grocery-list-application-in-js-part-iv">Part IV – Feature: List-Item-Controller</a><br>
<a href="http://custardbelly.com/blog/2012/12/31/the-making-of-a-test-driven-grocery-list-application-in-js-part-v/">Part V – Feature: List-Controller Refactoring</a><br>
<a href="http://custardbelly.com/blog/2013/01/08/the-making-of-a-test-driven-grocery-list-application-in-js-part-vi/" target="_blank">Part VI – Back to Passing</a><br>
<a href="http://custardbelly.com/blog/2013/01/17/the-making-of-a-test-driven-grocery-list-application-in-js-part-vii/">Part VII – Remove Item</a><br>
<a href="http://custardbelly.com/blog/2013/01/22/the-making-of-a-test-driven-grocery-list-application-part-viii/">Part VIII – Bug Fixing</a><br>
<a href="http://custardbelly.com/blog/2013/02/15/the-making-of-a-test-driven-grocery-list-application-in-js-part-ix/">Part IX – Persistence</a><br>
<a href="http://custardbelly.com/blog/2013/03/06/the-making-of-a-test-driven-grocery-list-application-in-js-part-x/">Part X – It Lives!</a></p>
		<div class="clear"></div>
	</div><!-- .entry-content-->
	
	<p class="filed categories alt-font tight">Posted in <a href="http://custardbelly.com/blog/category/amd/" title="View all posts in AMD" rel="category tag">AMD</a>,  <a href="http://custardbelly.com/blog/category/javascript/" title="View all posts in JavaScript" rel="category tag">JavaScript</a>,  <a href="http://custardbelly.com/blog/category/requirejs/" title="View all posts in RequireJS" rel="category tag">RequireJS</a>,  <a href="http://custardbelly.com/blog/category/grocery-ls/" title="View all posts in grocery-ls" rel="category tag">grocery-ls</a>,  <a href="http://custardbelly.com/blog/category/jasmine/" title="View all posts in jasmine" rel="category tag">jasmine</a>,  <a href="http://custardbelly.com/blog/category/unit-testing/" title="View all posts in unit-testing" rel="category tag">unit-testing</a>.</p>
	
	

	<p class="by-line">
		<span class="author vcard full-author">
			<span class="by alt-font">By</span> <a class="url fn" href="http://custardbelly.com/blog/author/todd-anderson/" title="View all posts by todd anderson">todd anderson</a>		</span>
		<span class="date full-date"><span class="ndash alt-font">–</span> <abbr class="published" title="2013-01-17T07:58">January 17, 2013</abbr></span>
	</p><!--/by-line-->

	<div id="post-comments-742-target"></div>
	<div class="clear"></div>
	
	